<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://unpkg.com/vue@next"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
    integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  <link rel="stylesheet" href="/css/Chat.css">
</head>

<body>
  <div id="app">
    {{test}}
    <div class="room">
      <div v-for="content in chatData" :key="content.PostDate">
        <div class="message-date-box">
          <span class="message-date">{{content.PostDate}}</span>
        </div>
        <template v-for="(item, index) in content.MessageBox" :key="index">
          <message-box :chat-data="item"></message-box>
        </template>
        
        <!-- <div class="messageBox">
          <div class="messageBox-photo">
            <img src="/image/user.jpg" alt="">
          </div>
          <div class="messageBox-info-left">
            <div class="bubble-arrow-left"></div>
            <div class="messageBox-name">Kevin</div>
            <div class="messageBox-message">
              <div class="messageBox-message-left">好哦 因為欄位性質重複，剛剛才發現如果新加一天上去要改兩個地方，感覺怪怪的</div>
              <div class="messageBox-time-left">上午 11:57</div>
            </div>
            <div class="messageBox-message">
              <div class="messageBox-message-left">對阿</div>
              <div class="messageBox-time-left">上午 11:58</div>
            </div>
          </div>
        </div>
        <div class="messageBox-self">
          <div class="messageBox-info-right">
            <div class="bubble-arrow-right"></div>
            <div class="messageBox-message">
              <div class="messageBox-time-right">
                <div class="read" style="text-align: right;">已讀 5</div>
                下午 3:38
              </div>
              <div class="messageBox-message-right">
                資料庫的欄位我想把Trip表格中的TotalDate移掉，因為TotalDate可以用TripId去查詢TripDay的表格查出來。因為如果多出otalDate這個欄位，在旅遊規劃時如果增加/刪除天數，除了修改TripDay的表格外(增加/刪除DayId)，還需要修改Trip的TotalDate
              </div>
            </div>
            <div class="messageBox-message-last">
              <div class="messageBox-time-right">
                <div class="read" style="text-align: right;">已讀 5</div>
                下午 3:39
              </div>
              <div class="messageBox-message-right">這樣有點重複</div>
            </div>
          </div>
        </div>
        <div class="messageBox">
          <div class="messageBox-photo">
            <img src="/image/user.jpg" alt="">
          </div>
          <div class="messageBox-info-left">
            <div class="bubble-arrow-left"></div>
            <div class="messageBox-name">Kevin</div>
            <div class="messageBox-message">
              <div class="messageBox-message-left">我是真的覺得視覺上蠻擠的</div>
              <div class="messageBox-time-left">上午 11:57</div>
            </div>
            <div class="messageBox-message">
              <div class="messageBox-message-left">對阿</div>
              <div class="messageBox-time-left">上午 11:58</div>
            </div>
          </div>
        </div>
        <div class="messageBox">
          <div class="messageBox-photo">
            <img src="/image/user.jpg" alt="">
          </div>
          <div class="messageBox-info-left">
            <div class="bubble-arrow-left"></div>
            <div class="messageBox-name">Kevin</div>
            <div class="messageBox-message">
              <div class="messageBox-message-left">我是真的覺得視覺上蠻擠的</div>
              <div class="messageBox-time-left">上午 11:57</div>
            </div>
            <div class="messageBox-message">
              <div class="messageBox-message-left">對阿</div>
              <div class="messageBox-time-left">上午 11:58</div>
            </div>
          </div>
        </div> -->
      </div>
    </div>
    <div class="enter-message">
      <input type="text" class="message" placeholder="請輸入...">
      <button type="button" class="send btn btn-sm btn-success">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
  <script>
    const messageBox = {
      template: `
      <div class="messageBox" v-if="chatData.CurrentUserName !== chatData.UserName">
        <div class="messageBox-photo">
          <img :src="chatData.UserImage" :title="chatData.UserName">
        </div>
        <div class="messageBox-info-left">
          <div class="bubble-arrow-left"></div>
          <div class="messageBox-name">{{chatData.UserName}}</div>
          <div class="messageBox-message" v-for="(message, index) in chatData.TotalMessage" :key="message.CommentId">
            <div class="messageBox-message-left">{{message.Message}}</div>
            <div class="messageBox-time-left" v-if="index == chatData.TotalMessage.length - 1">
              {{chatData.PostType}} {{chatData.PostTime}}
            </div>
          </div>
        </div>
      </div>
      <div class="messageBox-self" v-else>
        <div class="messageBox-info-right">
          <div class="bubble-arrow-right"></div>
          <div class="messageBox-message" v-for="(message, index) in chatData.TotalMessage" :key="message.CommentId">
            <div class="messageBox-time-right">
              <div class="read" style="text-align: right;">已讀 {{message.ReadQuantity}}</div>
              <span v-if="index == chatData.TotalMessage.length - 1">
                {{chatData.PostType}} {{chatData.PostTime}}
              </span>
            </div>
            <div class="messageBox-message-right">{{message.Message}}</div>
          </div>
        </div>
      </div>`,
      props: ['chatData'],
      watch:{
        chatData:{
          handler: function(){
            console.log(this.chatData);
            
          }
        }
      }
    }
    const App = {
      data() {
        return {
          test: '123',
          chatData: [],
        }
      },
      methods: {
        getChatData() {
          let url = 'https://raw.githubusercontent.com/r04941090/FileStorage/master/ChatData'
          axios.get(url).then(res => {
            console.log(res);
            this.chatData = res.data
            console.log(this.chatData);
          })
        }
      },
      components: {
        messageBox
      },
      mounted() {
        this.getChatData()
      },
    }
    Vue.createApp(App).mount('#app')
  </script>
</body>

</html>