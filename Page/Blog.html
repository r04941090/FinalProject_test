<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
    integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/Blog.css">
  <script src="https://unpkg.com/vue@next"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@ckeditor/ckeditor5-vue@2.0.1/dist/ckeditor.min.js"></script>
  <script src="/js/ckeditor.js"></script>
  <link rel="stylesheet" href="/css/Loading.css">
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-sweetalert2@5.0.2/dist/vue-sweetalert.umd.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/element-plus"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/element-plus/dist/index.css" />
  
  <title>Document</title>
</head>

<body>
  <div id="app" style="position: relative;">
    <div style="height: 60px; background-color: #000; width: 100%;"></div>
    <div class="Loading-container" style="background-color: #fff; height: calc(100vh - 60px); top: 60px;" v-if="initialLoading">
      <div class="sk-fading-circle">
          <div class="sk-fading-circle1 sk-child-first"></div>
          <div class="sk-fading-circle2 sk-child-first"></div>
          <div class="sk-fading-circle3 sk-child-first"></div>
          <div class="sk-fading-circle4 sk-child-first"></div>
          <div class="sk-fading-circle5 sk-child-first"></div>
          <div class="sk-fading-circle6 sk-child-first"></div>
          <div class="sk-fading-circle7 sk-child-first"></div>
          <div class="sk-fading-circle8 sk-child-first"></div>
          <div class="sk-fading-circle9 sk-child-first"></div>
          <div class="sk-fading-circle10 sk-child-first"></div>
          <div class="sk-fading-circle11 sk-child-first"></div>
          <div class="sk-fading-circle12 sk-child-first"></div>
      </div>
  </div>
    <div class="position-relative">
      <div class="blog-banner" :style="{backgroundImage: `url(${bloggerData.CoverImage})`}">
        <input type="file" class="cover-file" style="display:none" ref="userCoverImg" v-on:change="getUserCoverImg">
        <i class="fas fa-camera update-user-photo" style="top: 350px; right: 10px;" v-show="visitorId == bloggerData.UserId" v-on:click="callUserCoverImg" style="top: 350px; left: 1210px"></i>
      </div>
      <div class="d-flex flex-column align-items-center position-absolute user-details">
        <input type="file" class="cover-file" style="display:none" ref="userPhoto" v-on:change="getUserPhoto">
        <div class="user-icon mb-1" :style="{backgroundImage: `url(${bloggerData.UserPhoto})`}" title="bloggerData.UserName" >
          <i class="fas fa-camera update-user-photo" style="top: 87px; left: 87px;" v-show="visitorId == bloggerData.UserId" v-on:click="callUserPhoto"></i>
        </div>
        <p class="user-name m-0 fs-4">{{ bloggerData.UserName }}</p>
        <p class="user-id fs-6 mb-2">@{{ bloggerData.AccountId }}</p>
        <!-- 自己的部落格不會有 -->
        <button class="blogger-trace" v-show="(visitorId !== null) && (visitorId != bloggerData.UserId)" :class="{'tracing': bloggerData.TraceOrNot}" v-on:click="updateTrace(bloggerData.UserId, bloggerData)">
          {{ bloggerData.TraceOrNot ? '追蹤中' : '追蹤' }}
        </button>
        
      </div>
    </div>
    <div class="container blog-content-container">
      <div class="blog-content m-auto">
        <ul class="blog-content-list d-flex border-bottom ps-0 m-0 mt-2">
          <li class="me-2 h-100 p-2" v-on:click="currentPage = '簡介'" :class="{'listChange': currentPage == '簡介'}">
            <span class="blog-content-title">簡介</span>
          </li>
          <li class="mx-3 p-2" v-if="accountId == 'TripWay'" v-on:click="getBlogProduct(1)" :class="{'listChange': currentPage == '商品'}">
            <span class="blog-content-product-number">{{ blogItemsNumber.ProductNumber}}</span>
            <span class="blog-content-title"> 商品</span>
          </li>
          <li class="mx-2 p-2" v-on:click="getBlogJournal(1)" :class="{'listChange': currentPage == '旅遊回憶'}">
            <span class="blog-content-memory-number">{{ blogItemsNumber.JournalNumber }}</span>
            <span class="blog-content-title"> 旅遊回憶</span>
          </li>
          <li class="mx-2 p-2" v-on:click="getBlogPlan(1)" :class="{'listChange': currentPage == '行程'}">
            <span class="blog-content-tour-number">{{ blogItemsNumber.TripNumber }}</span>
            <span class="blog-content-title"> 行程</span>
          </li>
          <li class="mx-2 p-2" v-on:click="getAttraction(1)" :class="{'listChange': currentPage == '景點收藏'}">
            <span class="blog-content-place-number">{{ blogItemsNumber.AttractionNumber }}</span>
            <span class="blog-content-title"> 景點收藏</span>
          </li>
          <li class="mx-2 p-2" v-on:click="getBlogLike()" :class="{'listChange': currentPage == '讚'}">
            <span class="blog-content-like-number">{{ blogItemsNumber.LikeNumber }}</span>
            <span class="blog-content-title"> 讚</span>
          </li>
          <li class="mx-2 p-2" v-on:click="getFans(1)" :class="{'listChange': currentPage == '粉絲'}">
            <span class="blog-content-fans-number">{{ blogItemsNumber.FansNumber }}</span>
            <span class="blog-content-title"> 粉絲</span>
          </li>
          <li class="mx-2 p-2" v-on:click="getBlogTrace(1)" :class="{'listChange': currentPage == '追蹤中'}">
            <span class="blog-content-follow-number">{{ blogItemsNumber.TraceNumber }}</span>
            <span class="blog-content-title"> 追蹤中</span>
          </li>
        </ul>
        <!-- 簡介 -->
        <div v-if="currentPage == '簡介'" :style="{'min-height': (bloggerData.UserIntro == '' || bloggerData.UserIntro == null) && (bloggerData.BlogProductCard.length == 0) && (bloggerData.BlogPlanCard.length == 0) && (bloggerData.BlogJournalCard.length == 0) ? '0px' : '950px'}">
          <div class="noJournal" v-if="(bloggerData.UserIntro == '' || bloggerData.UserIntro == null) && (bloggerData.BlogProductCard.length == 0) && (bloggerData.BlogPlanCard.length == 0) && (bloggerData.BlogJournalCard.length == 0)">
            <img src="https://res.cloudinary.com/ditncduk1/image/upload/v1634544590/Blogger/jcpspdpfl3rtyibxjbur.svg" alt="">
            <div style="margin-top: 10px;">尚無公開資訊</div>
          </div>
          <div class="mt-2" style="border-bottom: 1px solid #dee2e6; padding-bottom: 20px; padding-top: 10px;" :class="{'intro-edit': visitorId == bloggerData.UserId}" v-if="(bloggerData.UserIntro !== '') || (bloggerData.BlogProductCard.length !== 0) || (bloggerData.BlogPlanCard.length !== 0) || (bloggerData.BlogJournalCard.length !== 0)">
            <ckeditor :editor="editor" :config="editorConfig" v-model="bloggerData.UserIntro" v-if="visitorId == bloggerData.UserId" v-on:blur="UpdateIntro()" v-on:focus="GetOriginIntro(bloggerData.UserIntro)"></ckeditor>
            <div style="max-height: 180px; overflow: auto;" v-html="bloggerData.UserIntro" v-else></div>
          </div>
          <div>
            <div class="d-flex py-2 mt-3" v-if="bloggerData.BlogProductCard.length !== 0">
              <div style="font-weight: bold; font-size: 18px;">商品</div>
              <div class="more ms-auto" id="tourMore" v-on:click="getBlogProduct(1)">更多</div>
            </div>
            <product-card :card-data="bloggerData.BlogProductCard"></product-card>
            <div class="d-flex py-2 mt-3" v-if="bloggerData.BlogPlanCard.length !== 0">
              <div style="font-weight: bold; font-size: 18px;">行程</div>
              <div class="more ms-auto" id="tourMore" v-on:click="getBlogPlan(1)">更多</div>
            </div>
            <plan-journal-card :card-data="bloggerData.BlogPlanCard" v-on:update-like="updateLike" :visitor="visitorId"></plan-journal-card>
            <div class="d-flex py-2 mt-3" v-if="bloggerData.BlogJournalCard.length !== 0">
              <div style="font-weight: bold; font-size: 18px;">旅遊回憶</div>
              <div class="more ms-auto" id="tourMore" v-on:click="getBlogJournal(1)">更多</div>
            </div>
            <plan-journal-card :card-data="bloggerData.BlogJournalCard" v-on:update-like="updateLike" :visitor="visitorId"></plan-journal-card>
          </div>
        </div>
        <div v-if="currentPage !== '簡介'" style="position: relative;">
          <loading :loading="loading" style="position: absolute;"></loading>
          <!-- Product -->
          <div v-if="currentPage == '商品'" :style="{'min-height': selectBlogCard.selectBlogProductCard.length == 0 ? '0px' : '950px'}">
            <div class="noJournal" v-show="selectBlogCard.selectBlogProductCard.length == 0">
              <img src="https://res.cloudinary.com/ditncduk1/image/upload/v1634544588/Blogger/qenyuljzeb96gzbfzh9f.svg" alt="">
              <div style="margin-top: 10px;">找不到商品</div>
            </div>
            <product-card :card-data="selectBlogCard.selectBlogProductCard"></product-card>
          </div>
          <!-- Plan -->
          <div v-if="currentPage == '行程'" :style="{'min-height': selectBlogCard.selectBlogPlanCard.length == 0 ? '0px' : '950px'}">
            <div class="noJournal" v-show="selectBlogCard.selectBlogPlanCard.length == 0">
              <img src="https://res.cloudinary.com/ditncduk1/image/upload/v1634544590/Blogger/jcpspdpfl3rtyibxjbur.svg" alt="">
              <div style="margin-top: 10px;">沒有公開行程</div>
            </div>
            <plan-journal-card :card-data="selectBlogCard.selectBlogPlanCard" v-on:update-like="updateLike"  :visitor="visitorId"></plan-journal-card>
          </div>
          <!-- Journal -->
          <div v-if="currentPage == '旅遊回憶'" :style="{'min-height': selectBlogCard.selectBlogJournalCard.length == 0 ? '0px' : '950px'}">
            <div class="noJournal" v-show="selectBlogCard.selectBlogJournalCard.length == 0">
              <img src="https://res.cloudinary.com/ditncduk1/image/upload/v1634544588/Blogger/qenyuljzeb96gzbfzh9f.svg" alt="">
              <div style="margin-top: 10px;">找不到旅遊回憶</div>
            </div>
            <plan-journal-card :card-data="selectBlogCard.selectBlogJournalCard" v-on:update-like="updateLike" :visitor="visitorId"></plan-journal-card>
          </div>
          
          <!-- 景點收藏，一次顯示10個 -->
          <div style="margin-top: 10px;" v-if="currentPage == '景點收藏'" :style="{'min-height': totalAttraction.length == 0 ? '0px' : '950px'}">
            <div class="noJournal" v-show="totalAttraction.length == 0">
              <img src="https://res.cloudinary.com/ditncduk1/image/upload/v1634544590/Blogger/jcpspdpfl3rtyibxjbur.svg" alt="">
              <div style="margin-top: 10px;">尚未收藏景點</div>
            </div>
            <div style="position: relative;" v-for="item in totalAttraction">
              <a :href=`/posi/${item.PlaceName}` class="attraction-collection">
                <div class="attraction-collection-img">
                  <img :src="item.PlaceImage" alt="">
                </div>
                <div style="margin-right: 30px;">
                  {{ item.PlaceName }}
                </div>
              </a>
              <el-popconfirm title="確定刪除此景點嗎？" v-on:Confirm="deleteItem(item)" style="position: absolute; top: -7px; right: -7px;" v-show="visitorId == bloggerData.UserId">
                <template #reference>
                  <el-button style="border-radius: 20px;">
                    <i class="fas fa-trash-alt" ></i>
                  </el-button>
                </template>
              </el-popconfirm>
            </div>
            
          </div>

          <!-- Like -->
          <div style="margin-top: 10px;" v-if="currentPage == '讚'" :style="{'min-height': totalAttraction.length == 0 ? '0px' : '950px'}">
            <div class="noJournal" v-show="currentSelectPageInfo.total == 0">
              <img src="https://res.cloudinary.com/ditncduk1/image/upload/v1634544588/Blogger/qenyuljzeb96gzbfzh9f.svg" alt="">
              <div style="margin-top: 10px;">尚無公開資訊</div>
            </div>
            <el-radio-group v-model="selectLike" v-on:change="selectLikeChange" v-if="totalAttraction.length != 0">
              <el-radio :label="1" :disable="bloggerLikeDataNumber.BlogPlanLikeCardNumber == 0">行程</el-radio>
              <el-radio :label="2" :disable="bloggerLikeDataNumber.BlogJournalLikeCardNumber == 0">旅遊回憶</el-radio>
              <el-radio :label="3" :disable="bloggerLikeDataNumber.BlogProductLikeCardNumber == 0">商品</el-radio>
            </el-radio-group>
            <!-- Product -->
            <div v-if="selectLike == 3">
              <div>商品</div>
              <product-card :card-data="bloggerLikeData.BlogProductSelectLikeCard" v-on:update-like="updateLike" :visitor="visitorId"></product-card>
            </div>

            <!-- Plan -->
            <div v-if="selectLike == 1">
              <div>行程</div>
              <plan-journal-card :card-data="bloggerLikeData.BlogPlanSelectLikeCard" v-on:update-like="updateLike" :visitor="visitorId"></plan-journal-card>
            </div>

            <!-- Journal -->
            <div v-if="selectLike == 2">
              <div>旅遊回憶</div>
              <plan-journal-card :card-data="bloggerLikeData.BlogJournalSelectLikeCard" v-on:update-like="updateLike" :visitor="visitorId"></plan-journal-card>
            </div>

          </div>

          <!-- fans -->
          <div v-if="currentPage == '粉絲'" :style="{'min-height': blogFans.length == 0 ? '0px' : '950px'}">
            <div class="noJournal" v-show="blogFans.length == 0">
              <img src="https://res.cloudinary.com/ditncduk1/image/upload/v1634544043/Blogger/g3miq63yx1seaepzcb7p.svg" alt="">
              <div style="margin-top: 10px;">你還沒有任何粉絲</div>
            </div>
            <div class="d-flex align-items-center p-2 personal-list" v-for="item in blogFans">
              <a :href='item.AccountId' style="text-decoration: none;">
                <div class="author-content d-flex align-items-center">
                  <div class="author-content-img">
                    <img :src="item.UserPhoto" alt="" class="h-100">
                  </div>
                  <div class="author-content-name ms-2" style="color: #000">{{ item.UserName }}</div>
                </div>
              </a>
              <div class="author-track ms-auto" :class="{'tracing': item.TraceOrNot}" v-if="item.UserId != visitorId" v-on:click="updateTrace(item.UserId, item)" >
                {{ item.TraceOrNot ? '追蹤中' : '追蹤' }}
              </div>
            </div>
            
          </div>

          <!-- trace  -->
          <div v-if="currentPage == '追蹤中'" style="min-height: 950px">
            <div class="noJournal" v-show="blogTraces.blogTrace.length == 0">
              <img src="https://res.cloudinary.com/ditncduk1/image/upload/v1634544043/Blogger/g3miq63yx1seaepzcb7p.svg" alt="">
              <div style="margin-top: 10px;">你尚未追蹤任何人</div>
            </div>
            <div class="border-bottom pb-2" v-show="blogTraces.blogTrace.length !== 0">
              <div style="min-height: 600px;" >
                <div class="d-flex align-items-center p-2 personal-list" v-for="item in blogTraces.blogTrace" :key="item.UserId">
                  <a :href='item.AccountId' style="text-decoration: none;">
                    <div class="author-content d-flex align-items-center">
                      <div class="author-content-img">
                        <img :src="item.UserPhoto" alt="" class="h-100">
                      </div>
                      <div class="author-content-name ms-2" style="color: #000">{{ item.UserName }}</div>
                    </div>
                  </a>
                  <div class="author-track ms-auto" :class="{'tracing': item.TraceOrNot}" v-if="item.UserId != visitorId" v-on:click="updateTrace(item.UserId, item)" >
                    {{ item.TraceOrNot ? '追蹤中' : '追蹤' }}
                  </div>
                </div>
              </div>  
              <div class="d-flex justify-content-center" v-if="currentPage == '追蹤中'">
                <!-- https://element.eleme.io/#/zh-CN/component/pagination -->
                <el-pagination
                  background
                  layout="prev, pager, next"
                  :total="currentSelectPageInfo.total * 10"
                  :current-page="currentSelectPageInfo.current"
                  v-on:current-change="pageChange">
                </el-pagination>
                <!-- <nav aria-label="Page navigation example">
                  <ul class="pagination">
                    <li class="page-item" :disable="currentSelectPageInfo.current == 1" :style="{'cursor': currentSelectPageInfo.current == 1 ? 'not-allowed' : 'pointer'}" v-on:click="minusPage">
                      <span class="page-link" href="#" aria-label="Previous">
                        <span aria-hidden="true" :class="{'page-disable': currentSelectPageInfo.current == 1}">&laquo;</span>
                      </span>
                    </li>
                    <li class="page-item" v-for="item in currentSelectPageInfo.total" :class="{'active': item == currentSelectPageInfo.current}" v-on:click.stop="changeData(item)" style="cursor: pointer">
                      <span class="page-link" href="#">{{ item }}</span>
                    </li>
                    <li class="page-item" :disable="currentSelectPageInfo.total == currentSelectPageInfo.current" :style="{'cursor': currentSelectPageInfo.current == currentSelectPageInfo.total ? 'not-allowed' : 'pointer'}" v-on:click="addPage">
                      <span class="page-link" href="#" aria-label="Next" >
                        <span aria-hidden="true" :class="{'page-disable': currentSelectPageInfo.current == currentSelectPageInfo.total}">&raquo;</span>
                      </span>
                    </li>
                  </ul>
                </nav> -->
              </div>
            </div>
            
            <div>
              <div class="headline" style="margin-top: 10px;">推薦追蹤</div>
              <div class="d-flex align-items-center p-2 personal-list" v-for="item in blogTraces.blogRecommendTrace">
                <a :href='item.AccountId' style="text-decoration: none;">
                  <div class="author-content d-flex align-items-center">
                    <div class="author-content-img">
                      <img :src="item.UserPhoto" alt="" class="h-100">
                    </div>
                    <div class="author-content-name ms-2" style="color: #000">{{ item.UserName }}</div>
                  </div>
                </a>
                <div class="author-track ms-auto" :class="{'tracing': item.TraceOrNot}" v-if="item.UserId != visitorId" v-on:click="updateTrace(item.UserId, item)" >
                  {{ item.TraceOrNot ? '追蹤中' : '追蹤' }}
                </div>
              </div>
            </div>
          </div>

          <!-- pagnition (不做成元件) -->
          <!--  -->
          <div class="d-flex justify-content-center" v-if="(currentSelectPageInfo.total !== 0) && (currentPage != '追蹤中')">
            <!-- v-if="currentSelectPageInfo.total !== 0" -->
            <el-pagination
              background
              layout="prev, pager, next"
              :total="currentSelectPageInfo.total * 10"
              :current-page="currentSelectPageInfo.current"
              v-on:current-change="pageChange"
              v-if="currentSelectPageInfo.total !== 0">
            </el-pagination>
            <!-- <nav aria-label="Page navigation example">
              <ul class="pagination">
                <li class="page-item" :disable="currentSelectPageInfo.current == 1" :style="{'cursor': currentSelectPageInfo.current == 1 ? 'not-allowed' : 'pointer'}" v-on:click="minusPage">
                  <span class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true" :class="{'page-disable': currentSelectPageInfo.current == 1}">&laquo;</span>
                  </span>
                </li>
                <li class="page-item" v-for="item in currentSelectPageInfo.total" :class="{'active': item == currentSelectPageInfo.current}" v-on:click.stop="changeData(item)" style="cursor: pointer">
                  <span class="page-link" href="#">{{ item }}</span>
                </li>
                <li class="page-item" :disable="currentSelectPageInfo.total == currentSelectPageInfo.current" :style="{'cursor': currentSelectPageInfo.current == currentSelectPageInfo.total ? 'not-allowed' : 'pointer'}" v-on:click="addPage">
                  <span class="page-link" href="#" aria-label="Next" >
                    <span aria-hidden="true" :class="{'page-disable': currentSelectPageInfo.current == currentSelectPageInfo.total}">&raquo;</span>
                  </span>
                </li>
              </ul>
            </nav> -->
          </div>
        </div>
      </div>
    </div>
    <div style="background-color: #000; height: 200px;"></div>
  </div>
  <!-- <script src="/js/Blog.js"></script> -->
  <script>
    const planJournalCard = {
      emits: ['updateLike'],
      props: ['cardData', 'visitor'],
      template: `
        <div v-for="(item, index) in cardData">
          <div class="row my-3 blog-card">
            <div class="col-4 col-xl-3 position-relative pe-0">
              <a :href='link(item)'>
                <img src="https://picsum.photos/300/250/?random=2" class="w-100 h-100 rounded">
                <p class="m-0 position-absolute text-white blog-card-day">
                  {{ item.TotalDate }} 天
                </p>
              </a>
            </div>
            <div class="col-8 col-xl-9 d-flex flex-column justify-content-between">
              <div class="blog-card-content flex-grow-1 d-flex flex-column">
                <a :href='link(item)' style="text-decoration: none; color: #000;" >
                  <div class="blog-card-title">
                    {{ item.Title }}
                  </div>
                  <div class="blog-card-intro mt-2">
                    <p v-html="item.Intro"></p>
                  </div>
                </a>
              </div>
              <div class="blog-card-author">
                <a :href="item.AccountId" style="text-decoration: none; color: #000" class="d-flex align-self-start align-items-center">
                  <div class="blog-card-author-img me-2" :style="{'background-image': userImage(item)}"></div>
                  <div class="blog-card-author-name">{{ item.UserName }}</div>
                </a>
              </div>
              <div class="d-flex align-items-end">
                <p class="m-0 blog-card-other">
                  <span class="blog-card-other">{{ item.StartDate }} - {{ item.EndDate }}</span>
                  <span class="blog-card-other-interval">|</span>
                  <span class="blog-card-other-info">
                    <span class="blog-card-other-info-popular">{{ item.Popular }}</span>人氣,
                    <span class="blog-card-other-info-like">{{ item.Like }}</span>讚
                  </span>
                </p>
                <i class="fa-heart ms-auto blog-card-love" :style="{'color': item.LikeOrNot ? '#ff4477' : '#000'}" :class="{ 'fas': item.LikeOrNot, 'far': !item.LikeOrNot}" v-on:click="updateLike(item)" v-if="visitor != item.UserId"></i>
              </div>
            </div>
          </div>
        </div>
      `,
      methods: {
        link(item){
          let state = item.Type == '行程' ? 'trips' : 'journals'
          return `${item.AccountId}/${state}/${item.TripId}`
        },
        userImage(item) {
          return `url(${item.UserPhoto})`
        },
        updateLike(item){
          item.LikeOrNot = !item.LikeOrNot
          this.$emit('updateLike', item)
        }
      },
      
    }
    const productCard = {
      emits: ['updateLike'],
      props: ['cardData', 'visitor'],
      template: `
        <div v-for="(item, index) in cardData">
          <div class="row my-3 blog-card">
            <div class="col-4 col-xl-3 position-relative pe-0">
              <a :href='link(item)'>
                <img src="https://picsum.photos/300/250/?random=2" class="w-100 h-100 rounded">
              </a>
            </div>
            <div class="col-8 col-xl-9 d-flex flex-column justify-content-between">
              <div class="blog-card-content flex-grow-1 d-flex flex-column">
                <a :href='link(item)' style="text-decoration: none; color: #000;" >
                  <div class="blog-card-title">
                    {{ item.Title }}
                  </div>
                </a>
              </div>
              <div class="blog-card-author d-flex align-self-start align-items-center">
                <a :href="item.AccountId" style="text-decoration: none; color: #000" class="d-flex align-self-start align-items-center">
                  <div class="blog-card-author-img me-2" :style="{'background-image': userImage(item)}"></div>
                  <div class="blog-card-author-name">{{ item.UserName }}</div>
                </a>
              </div>
              <div class="d-flex align-items-end">
                <p class="m-0 blog-card-other">
                  <span class="blog-card-other-info">
                    <span class="blog-card-other-info-popular" style="margin-left: 0px;">{{ item.Popular }}</span>人氣,
                    <span class="blog-card-other-info-like" v-on:click="updateLike(item)" v-if="visitor != item.UserId">{{ item.Like }}</span>讚
                  </span>
                </p>
                <i class="fa-heart ms-auto blog-card-love" :style="{'color': item.LikeOrNot ? '#ff4477' : '#000'}" :class="{ 'fas': item.LikeOrNot, 'far': !item.LikeOrNot}" v-on:click="updateLike(item)" v-if="visitor != item.UserId"></i>
              </div>
            </div>
          </div>
        </div>
      `,
      methods: {
        link(item){
          return `${item.AccountId}/products/${item.TripId}`
        },
        userImage(item) {
          return `url(${item.UserPhoto})`
        },
        updateLike(item){
          item.LikeOrNot = !item.LikeOrNot
          this.$emit('updateLike', item)
        }
      },
    }
    const loading = {
      props: ['loading'],
      template: `
        <div class="Loading-container" style="background-color: #fff; position: absolute" v-if="loading">
          <div class="sk-fading-circle" style="top: 70px; left: calc(50%); position: absolute">
            
            <div class="sk-fading-circle1 sk-child-first"></div>
            <div class="sk-fading-circle2 sk-child-first"></div>
            <div class="sk-fading-circle3 sk-child-first"></div>
            <div class="sk-fading-circle4 sk-child-first"></div>
            <div class="sk-fading-circle5 sk-child-first"></div>
            <div class="sk-fading-circle6 sk-child-first"></div>
            <div class="sk-fading-circle7 sk-child-first"></div>
            <div class="sk-fading-circle8 sk-child-first"></div>
            <div class="sk-fading-circle9 sk-child-first"></div>
            <div class="sk-fading-circle10 sk-child-first"></div>
            <div class="sk-fading-circle11 sk-child-first"></div>
            <div class="sk-fading-circle12 sk-child-first"></div>
          </div>
        </div>
      `
    }
    const App = {
      data() {
        return {
          userPhotoReader: '',
          userCoverImgReader: '',
          initialLoading: false,
          loading: false,
          currentPage: '簡介',
          accountId: 'SHERRY', // 讀Razor
          visitorId: '5', // 進來看的人  讀Razor (有可能為本人)

          urls: {
            url_UploadImageCloudinary: 'https://api.cloudinary.com/v1_1/ditncduk1/upload',
            url_UpdatePhoto: 'https://localhost:44392/api/blogapi/UpdatePhoto',
            url_UpdateCoverImage: 'https://localhost:44392/api/blogapi/UpdateCoverImage',
            url_UpdateIntro: 'https://localhost:44392/api/blogapi/UpdateIntro',
            url_GetBlog: 'https://localhost:44392/api/blogapi/GetBlog',
            url_GetBlogNumberViewModel:'https://localhost:44392/api/blogapi/GetBlogNumberViewModel',
            url_GetBlogTrace: 'https://localhost:44392/api/blogapi/GetBlogTrace',
            url_GetRecommendBlogTrace: 'https://localhost:44392/api/blogapi/GetRecommendBlogTrace/',
            url_GetBlogPlan: 'https://localhost:44392/api/blogapi/GetBlogPlan/',
            url_GetBlogJournal: 'https://localhost:44392/api/blogapi/GetBlogJournal',
            url_GetBlogProduct: 'https://localhost:44392/api/blogapi/GetBlogProduct',
            url_GetAttractionCollection: 'https://localhost:44392/api/blogapi/GetAttractionCollection/',
            url_GetRecommendBlogTrace: 'https://localhost:44392/api/blogapi/GetRecommendBlogTrace',
            url_UpdateLike: 'https://localhost:44392/api/blogapi/UpdateLike',
            url_UpdateTrace: 'https://localhost:44392/api/blogapi/UpdateTrace',
            url_GetBlogLike: 'https://localhost:44392/api/blogapi/GetBlogLike/',
            url_GetFans: 'https://localhost:44392/api/blogapi/GetBlogFans/',
            url_GetAttraction: 'https://localhost:44392/api/planapi/GetAttractionCollection/',
            url_DeleteAttractionCollection: 'https://localhost:44392/api/blogapi/DeleteAttractionCollection',
            url_GetAttractionCollectionNumber: 'https://localhost:44392/api/blogapi/GetAttractionCollectionNumber'
          },
          currentSelectPageInfo: {
            total: 0,
            current: 1
          },
          selectLike: '',
          blogItemsNumber: {},
          editor: ClassicEditor,
          editorData: '',
          editorConfig: {
            placeholder: '簡介',
            fontFamily: {
              options: [
                "default",
                "Ubuntu, Arial, sans-serif",
                "Ubuntu Mono, Courier New, Courier, monospace",
                "Microsoft JhengHei"
              ],
            },
            fontSize: {
              options: [9, 12, "default", 16, 18, 20],
            },
            toolbar: {
              items: [
                'heading', '|', 'fontSize', 'fontFamily', '|', 'fontColor', 'fontBackgroundColor', '|', 'bold', 'italic', 'underline', 'strikethrough', '|', 'alignment', '|', 'numberedList', 'bulletedList', '|', 'outdent', 'indent', '|', 'undo', 'redo'
              ]
            }
          },
          // 原始的介紹
          originIntro: '',
          // 景點收藏
          totalAttraction: [],
          // 粉絲資料
          blogFans: [],
          // 根據page去讀取資料
          selectBlogCard: {
            selectBlogPlanCard: [],
            selectBlogJournalCard: [],
            selectBlogProductCard: []
          },
          // 初始化資料
          bloggerData: {
            BlogProductCard: [],
            BlogPlanCard: [],
            BlogJournalCard: []
          },
          // 有按讚的資料
          bloggerLikeData: {
            BlogProductLikeCard: {},
            BlogProductSelectLikeCard: {},
            BlogPlanLikeCard: {},
            BlogPlanSelectLikeCard: {},
            BlogJournalLikeCard: {},
            BlogJournalSelectLikeCard: {}
          },
          bloggerLikeDataNumber: {
            BlogProductLikeCardNumber: 0,
            BlogPlanLikeCardNumber: 0,
            BlogJournalLikeCardNumber: 0
          },
          // 有追蹤的資料
          blogTraces: {
            blogTrace: [],
            blogRecommendTrace: []
          },
        }
      },
      methods: {
        pageChange(value){
          console.log(value);
          this.changeData(value)
        },
        getData() {
          this.initialLoading = true
          axios.get(`${this.urls.url_GetBlogNumberViewModel}/?accountId=${this.accountId}`).then(res => {
            this.blogItemsNumber = res.data
            document.querySelector('body').style.overflow = 'hidden';
            axios.get(`${this.urls.url_GetBlog}/?accountId=${this.accountId}&id=${this.visitorId}`).then(res => {
              this.bloggerData = res.data
              this.$nextTick(() => {
                this.initialLoading = false
                document.querySelector('body').style.overflow = 'auto';
              });
            })
          })
        },
        changeData(page){
          if (this.currentPage == '行程'){
              this.getBlogPlan(page)
            }
            else if(this.currentPage == '旅遊回憶'){
              this.getBlogJournal(page)
            }
            else if(this.currentPage == '景點收藏'){
              this.getAttraction(page)
            }
            else if(this.currentPage == '追蹤中'){
              this.getBlogTrace(page)
            }
            else if(this.currentPage == '讚'){
              if (this.selectLike == 1){
                // 行程
                last = page == this.currentSelectPageInfo.total ? this.bloggerLikeData.BlogPlanLikeCard.length : 5
                this.bloggerLikeData.BlogPlanSelectLikeCard = this.bloggerLikeData.BlogPlanLikeCard.slice((page - 1) * 5, last)
              }
              else if(this.selectLike == 2){
                last = page == this.currentSelectPageInfo.total ? this.bloggerLikeData.BlogJournalLikeCard.length : 5
                this.bloggerLikeData.BlogJournalSelectLikeCard = this.bloggerLikeData.BlogJournalLikeCard.slice((page - 1) * 5, last)
              }
              else{
                last = page == this.currentSelectPageInfo.total ? this.bloggerLikeData.BlogProductLikeCard.length : 5
                this.bloggerLikeData.BlogProductSelectLikeCard = this.bloggerLikeData.BlogProductLikeCard.slice((page - 1) * 5, last)
              }
              this.currentSelectPageInfo.current = page
            }
        },
        intitialScroll(){
          window.scrollTo({
            top: 265,
            left: 0,
            behavior: 'instant'
          })
        },
        getFans(page){
          axios.get(`${this.urls.url_GetFans}/?accountId=${this.accountId}&id=${this.visitorId}&page=${page}`).then(res => {
            console.log(res);
            this.currentSelectPageInfo.total = Math.ceil(this.blogItemsNumber.FansNumber / 15)
            this.currentSelectPageInfo.current = page
            this.currentPage = '粉絲'
            this.blogFans = res.data.BlogFans
          })
        },
        getBlogPlan(page){
          this.currentPage = '行程'
          this.intitialScroll();
          this.loading = true
          axios.get(`${this.urls.url_GetBlogPlan}?accountId=${this.accountId}&id=${this.visitorId}&page=${page}`).then(res => {
            console.log(res);
            this.currentSelectPageInfo.total = Math.ceil(this.blogItemsNumber.TripNumber / 6)
            this.currentSelectPageInfo.current = page
            this.selectBlogCard.selectBlogPlanCard = res.data
            this.loading = false
          })
        },
        getBlogJournal(page){
          this.currentPage = '旅遊回憶'
          this.intitialScroll();
          this.loading = true
          axios.get(`${this.urls.url_GetBlogJournal}/?accountId=${this.accountId}&id=${this.visitorId}&page=${page}`).then(res => {
            this.currentSelectPageInfo.total = Math.ceil(this.blogItemsNumber.JournalNumber / 6)
            this.currentSelectPageInfo.current = page
            console.log(res);
            this.selectBlogCard.selectBlogJournalCard = res.data
            this.loading = false
          })
        },
        getBlogProduct(page){
          this.currentPage = '商品'
          this.intitialScroll();
          this.loading = true
          axios.get(`${this.urls.url_GetBlogProduct}/?accountId=${this.accountId}&id=${this.visitorId}&page=${page}`).then(res => {
            this.currentSelectPageInfo.total = Math.ceil(this.blogItemsNumber.ProductNumber / 6)
            this.currentSelectPageInfo.current = page
            console.log(res);
            this.selectBlogCard.selectBlogProductCard = res.data
            this.loading = false
          })
        },
        getBlogTrace(page){
          this.currentPage = '追蹤中'
          this.intitialScroll();
          this.loading = true
          axios.get(`${this.urls.url_GetRecommendBlogTrace}/?accountId=${this.accountId}&id=${this.visitorId}`).then(res => {
            console.log(res.data);
            this.blogTraces.blogRecommendTrace = res.data.BlogTrace
            axios.get(`${this.urls.url_GetBlogTrace}/?accountId=${this.accountId}&id=${this.visitorId}&page=${page}`).then(res => {
              this.currentSelectPageInfo.total = Math.ceil(this.blogItemsNumber.TraceNumber / 10)
              this.currentSelectPageInfo.current = page
              this.blogTraces.blogTrace = res.data.BlogTrace
              axios.get(`${this.urls.url_GetRecommendBlogTrace}/?accountId=${this.accountId}&id=${this.visitorId}`).then(res => {
                console.log(res);
                this.blogTraces.blogRecommendTrace = res.data.BlogTrace
                console.log(this.blogTraces.blogTrace);
                this.loading = false
              })
            })
          })
        },
        getBlogLike(){
          this.currentPage = '讚'
          this.currentSelectPageInfo.total = 0
          this.intitialScroll();
          this.loading = true
          axios.get(`${this.urls.url_GetBlogLike}/?accountId=${this.accountId}&id=${this.visitorId}`).then(res => {
            console.log(res);
            this.bloggerLikeData = res.data
            let total = this.bloggerLikeData.BlogJournalLikeCard.length + this.bloggerLikeData.BlogPlanLikeCard.length + this.bloggerLikeData.BlogProductLikeCard.length
            if (total !== 0){
              this.selectLike =  this.bloggerLikeData.BlogPlanLikeCard.length != 0 ? 1 : (this.bloggerLikeData.BlogJournalLikeCard.length != 0 ? 2 : 3)
              if (this.selectLike == 1){
                // plan
                this.currentSelectPageInfo.total = Math.ceil(this.bloggerLikeData.BlogPlanLikeCard.length / 5)
                this.bloggerLikeData.BlogPlanSelectLikeCard = this.bloggerLikeData.BlogPlanLikeCard.slice(0, 5)
              }
              else if (this.selectLike == 2){
                // journal
                this.currentSelectPageInfo.total = Math.ceil(this.bloggerLikeData.BlogJournalLikeCard.length / 5)
                this.bloggerLikeData.BlogJournalSelectLikeCard = this.bloggerLikeData.BlogJournalLikeCard.slice(0, 5)
              }
              else{
                // product
                this.currentSelectPageInfo.total = Math.ceil(this.bloggerLikeData.BlogProductLikeCard.length / 5)
                this.bloggerLikeData.BlogProductSelectLikeCard = this.bloggerLikeData.BlogProductLikeCard.slice(0, 5)
              }
            }
            this.bloggerLikeDataNumber.BlogProductLikeCardNumber = this.bloggerLikeData.BlogProductLikeCard.length
            this.bloggerLikeDataNumber.BlogPlanLikeCardNumber = this.bloggerLikeData.BlogPlanLikeCard.length
            this.bloggerLikeDataNumber.BlogJournalLikeCardNumber = this.bloggerLikeData.BlogJournalLikeCard.length
            this.currentSelectPageInfo.current = 1
            this.loading = false
          })
        },
        getAttraction(page){
          this.currentPage = '景點收藏'
          this.intitialScroll();
          this.loading = true
          axios.get(`${this.urls.url_GetAttractionCollection}/?accountId=${this.accountId}&page=${page}`).then(res => {
            this.totalAttraction = res.data
            this.currentSelectPageInfo.total = Math.ceil(this.blogItemsNumber.AttractionNumber / 10)
            this.currentSelectPageInfo.current = page
            this.loading = false
          })
        },
        selectLikeChange(){
          console.log('aaa');
          if (this.selectLike == 1){
            // 行程
            this.bloggerLikeData.BlogPlanSelectLikeCard = this.bloggerLikeData.BlogPlanLikeCard.slice(0, 5)
          }
          else if(this.selectLike == 2){
            this.bloggerLikeData.BlogJournalSelectLikeCard = this.bloggerLikeData.BlogJournalLikeCard.slice(0, 5)
            console.log(this.bloggerLikeData.BlogJournalSelectLikeCard);
          }
          else{
            this.bloggerLikeData.BlogProductSelectLikeCard = this.bloggerLikeData.BlogProductLikeCard.slice(0, 5)
          }
        },
        updateLike(item){
          console.log(item);
          let request = {
            UserId: this.visitorId,
            TripId: item.TripId
          }
          console.log(request);
          
          axios.put(this.urls.url_UpdateLike, request).then(res => {
            console.log(res);
            item.Like = !item.LikeOrNot ? item.Like - 1 : item.Like + 1
          })
        },
        minusPage(){
          console.log();
          
          // if (this.currentSelectPageInfo.current - 1 >= 0){
          //   this.currentSelectPageInfo.current = this.currentSelectPageInfo.current - 1
          // }
        },
        addPage(){
          if (this.currentSelectPageInfo.current < this.currentSelectPageInfo.total ){
            this.currentSelectPageInfo.current = this.currentSelectPageInfo.current + 1
          }
        },
        deleteItem(item){
          console.log(item);
          axios.delete(`${this.urls.url_DeleteAttractionCollection}/?accountId=${this.accountId}&id=${item.AttractionsCollectionId}`).then(res => {
            if (res.data.IsSuccessful){
              this.notification('success', '刪除成功')
              axios.get(`${this.urls.url_GetAttractionCollectionNumber}/?accountId=${this.accountId}`).then(res => {
                this.blogItemsNumber.AttractionNumber = res.data
                this.currentSelectPageInfo.total = res.data
                this.getAttraction(this.currentSelectPageInfo.current)
              })
            }
          })
        },
        updateTrace(userId, select){
          let request = {
            // userId為要追蹤的人
            UserId: userId,
            FollowId: this.visitorId
          }
          console.log(request);
          
          axios.put(this.urls.url_UpdateTrace, request).then(res => {
            console.log(res);
            select.TraceOrNot = !select.TraceOrNot
          })
        },
        callUserPhoto() {
          console.log(this.$refs.userPhoto);
          this.$refs.userPhoto.click();
        },
        getUserPhoto(e){
          this.userPhotoReader.readAsDataURL(e.target.files[0])
        },
        updateUserPhoto(){
          let image;
          let request = {
            api_key: '819392311777911',
            file: this.userPhotoReader.result,
            // reader.result：base64
            api_secret: 'vWFjIgauRBwpAcELX8a6hve-WZY',
            upload_preset: 'g0uupmf7',
            folder: 'UserPhoto'
          }
          axios.post(this.urls.url_UploadImageCloudinary, request).then(res => {
            image = res.data.url
            axios.put(this.urls.url_UpdatePhoto, {
              UserId: this.visitorId,
              Photo: res.data.url
            }).then(res => {
              if (res.data.IsSuccessful){
                this.notification('success', '上傳成功')
                this.bloggerData.UserPhoto = image
              }
            })
          })
        },
        callUserCoverImg() {
          console.log(this.$refs.userCoverImg);
          this.$refs.userCoverImg.click();
        },
        getUserCoverImg(e){
          this.userCoverImgReader.readAsDataURL(e.target.files[0])
        },
        updateUserCoverImg(){
          let image;
          let request = {
            api_key: '819392311777911',
            file: this.userCoverImgReader.result,
            // reader.result：base64
            api_secret: 'vWFjIgauRBwpAcELX8a6hve-WZY',
            upload_preset: 'g0uupmf7',
            folder: 'UserCoverImage'
          }
          axios.post(this.urls.url_UploadImageCloudinary, request).then(res => {
            image = res.data.url
            axios.put(this.urls.url_UpdateCoverImage, {
              UserId: this.visitorId,
              Photo: res.data.url
            }).then(res => {
              if (res.data.IsSuccessful){
                this.notification('success', '上傳成功')
                this.bloggerData.CoverImage = image
              }
            })
          })
        },
        GetOriginIntro(originIntro){
          this.originIntro = originIntro
        },
        UpdateIntro(){
          if (this.bloggerData.UserIntro != this.originIntro){
            axios.put(this.urls.url_UpdateIntro, {
              UserId: this.visitorId,
              UserIntro: this.bloggerData.UserIntro
            }).then(res => {
              if (res.data.IsSuccessful) {
                this.notification('success', '修改成功')
              }
              else{
                this.notification('error', '修改失敗')
                this.bloggerData.UserIntro = this.originIntro
              }
            })
          }
        },
        notification(type, title) {
          // Use sweetalert2
          const Toast = Swal.mixin({
            toast: true,
            position: 'bottom',
            showConfirmButton: false,
            timer: 1500,
            // timerProgressBar: true,
            didOpen: (toast) => {
              toast.addEventListener('mouseenter', Swal.stopTimer)
              toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
          })
          Toast.fire({
            icon: type,
            title: title
          })
        },
      },
      watch:{
        selectLike: function(){
          if (this.selectLike == 1){
            // plan
            this.currentSelectPageInfo.total = Math.ceil(this.bloggerLikeData.BlogPlanLikeCard.length / 5)
            this.bloggerLikeData.BlogPlanSelectLikeCard = this.bloggerLikeData.BlogPlanLikeCard.slice(0, 5)
          }
          else if (this.selectLike == 2){
            this.currentSelectPageInfo.total = Math.ceil(this.bloggerLikeData.BlogJournalLikeCard.length / 5)
            this.bloggerLikeData.BlogJournalSelectLikeCard = this.bloggerLikeData.BlogJournalLikeCard.slice(0, 5)
          }
          else{
            this.currentSelectPageInfo.total = Math.ceil(this.bloggerLikeData.BlogProductLikeCard.length / 5)
            this.bloggerLikeData.BlogProductSelectLikeCard = this.bloggerLikeData.BlogProductLikeCard.slice(0, 5)
          }
          this.currentSelectPageInfo.current = 1
        },
        'currentSelectPageInfo.current': function(){
          // console.log(this.currentSelectPageInfo.current);
          this.changeData(this.currentSelectPageInfo.current)
        }
      },
      components: {
        planJournalCard,
        productCard,
        loading
      },
      mounted() {
        this.getData();
        this.userPhotoReader = new FileReader()
        this.userPhotoReader.addEventListener('load', this.updateUserPhoto)
        this.userCoverImgReader = new FileReader()
        this.userCoverImgReader.addEventListener('load', this.updateUserCoverImg)
      },
    }
    Vue.createApp(App).use(CKEditor).use(ElementPlus).mount('#app')
  </script>
</body>

</html>