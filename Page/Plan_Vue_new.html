<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
    integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCW6Ekw5sZ0JUZfzpMeSteJ6_8aoQRwfws&libraries=places"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  <link rel="stylesheet" href="/css/Plan.css">
  <link rel="stylesheet" href="/css/PlanPage_button.css">
  <link rel="stylesheet" href="/css/Loading.css">
  <link rel="stylesheet" href="/css/Plan_Day.css">

  <link rel="stylesheet" href="/css/map.css">
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.css" />
  <script src="https://unpkg.com/swiper/swiper-bundle.js"></script>
  <script src="https://unpkg.com/vue@next"></script>

  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/element-plus/dist/index.css" />
  <script src="//cdn.jsdelivr.net/npm/element-plus"></script>
</head>

<body ref="body">
  <div id="app">
    <div class="temp-header">
      <button @click="Loading=!Loading">loading</button>
      <button @click="changePage">change-page</button>
      <span style="color: #fff;">{{page}}</span>
    </div>
    <div class="outside position-relative">
      <div id="map" ref="map"></div>
      <div class="trip-list" v-show="showTripList" ref="tripList">
        <div class="Loading-container"
          :style="{backgroundColor: Loading ? 'rgba(0, 0, 0, 0.4)' : 'rgba(255, 255, 255, 0)', zIndex: Loading ? '1000' : '-1'}">
          <div :class="{'sk-fading-circle': Loading}">
            <span class="Loading" style="color:#fff;">è¼‰å…¥ä¸­ ...</span>
            <div class="sk-fading-circle1 sk-child"></div>
            <div class="sk-fading-circle2 sk-child"></div>
            <div class="sk-fading-circle3 sk-child"></div>
            <div class="sk-fading-circle4 sk-child"></div>
            <div class="sk-fading-circle5 sk-child"></div>
            <div class="sk-fading-circle6 sk-child"></div>
            <div class="sk-fading-circle7 sk-child"></div>
            <div class="sk-fading-circle8 sk-child"></div>
            <div class="sk-fading-circle9 sk-child"></div>
            <div class="sk-fading-circle10 sk-child"></div>
            <div class="sk-fading-circle11 sk-child"></div>
            <div class="sk-fading-circle12 sk-child"></div>
          </div>
        </div>
        <div class="Loading-container" style="background-color: #fff;" v-if="initialLoading">
          <div class="sk-fading-circle">
            <span class="Loading">è¼‰å…¥ä¸­ ...</span>
            <div class="sk-fading-circle1 sk-child-first"></div>
            <div class="sk-fading-circle2 sk-child-first"></div>
            <div class="sk-fading-circle3 sk-child-first"></div>
            <div class="sk-fading-circle4 sk-child-first"></div>
            <div class="sk-fading-circle5 sk-child-first"></div>
            <div class="sk-fading-circle6 sk-child-first"></div>
            <div class="sk-fading-circle7 sk-child-first"></div>
            <div class="sk-fading-circle8 sk-child-first"></div>
            <div class="sk-fading-circle9 sk-child-first"></div>
            <div class="sk-fading-circle10 sk-child-first"></div>
            <div class="sk-fading-circle11 sk-child-first"></div>
            <div class="sk-fading-circle12 sk-child-first"></div>
          </div>
        </div>
        <div class="trip-list-header-info" ref="tripListHeaderInfo">
          <div class="trip-list-header-back">
            <a href=""></a>
          </div>
          <div class="trip-list-header-content">
            <!-- component -->
            <div class="trip-list-header-title-container">
              <input type="text" class="trip-list-header-title edit-mode" v-model="rawData.TripTitle" v-if="edit">
              <div class="trip-list-header-title" v-if="!edit">{{rawData.TripTitle}}</div>
            </div>
            <div class="trip-list-header-date">
              <input type="date" v-model="StartDate" v-if="edit">
              <span v-if="!edit" style="margin-bottom: 2px; display: inline-block;">{{StartDateDisplay}}</span> -
              {{EndDate}}
            </div>
            <div class="trip-list-member">
              <a href="">
                <div class="member-img">
                  <!-- ä¿®æ”¹ -->
                  <img :src="rawData.UserImg" alt="" :title="rawData.UserName">
                </div>
              </a>
            </div>
            <div class="trip-list-header-edit">
              <span class="me-2" @click="edit = !edit">ç·¨è¼¯</span>
              <div class="onoffswitch d-inline-block">
                <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" tabindex="0"
                  checked v-model="edit">
                <label class="onoffswitch-label" for="myonoffswitch">
                  <span class="onoffswitch-inner"></span>
                  <span class="onoffswitch-switch"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="trip-list-header-day-container" :style="{'height': tripListHeight}" ref="tripListHeaderDayContainer"
          :class="{'edit-mode': edit}">
          <div class="dayBox" ref="dayBox">
            <div class="trip-list-header-day-component" ref="tripListHeaderDayComponent">
              <div class="day-item d-inline-block" v-for="tripContent in rawDataOnlyDay" :key="tripContent.Day"
                :data-id="tripContent.Day" @click="selectDay = tripContent">
                <day-cell :trip-data="tripContent" @mousedown="DayDragMouseDown" :select-day="selectDay"
                  @delete-data="getDeleteData" :edit="edit"></day-cell>
              </div>
              <div class="day-cell add-day" v-if="edit" @click="AddDay">
                <div class="day-cell-content">
                  <span><br>+</span>
                </div>
              </div>
            </div>
            <div class="page-controller">
              <a class="previous" @click="previous"></a>
              <a class="next" @click="next"></a>
            </div>
          </div>
        </div>
        <!-- Trip List -->
        <div class="trip-list-day-container" ref="tripListDayContainer">
          <div class="trip-item" v-for="(TripContent, index) in rawData.TripContent" :key="TripContent.Id"
            :data-id="TripContent.Id" @mousedown="DragMouseDown">
            <day :trip-content="TripContent" v-if="index == 0" @select-day="selectDayMethod"
              :show-day="showSpecificRoute" :edit="edit" @select-time="selectTime">
            </day>
            <place-gps :trip-content="TripContent" v-else-if="TripContent.Type == 'Place'" @copy-data="copyPlace"
              @delete-place="getDeletePlace" :edit="edit" @select-place="ShowPlacePage"
              @select-stay-time="selectStayTime">
            </place-gps>
            <day-plus :trip-content="TripContent" v-else-if="TripContent.Type == 'Day'" @select-day="selectDayMethod"
              :show-day="showSpecificRoute" @select-time="selectTime" :edit="edit" @add-place="changePage"></day-plus>
          </div>
          <div class="trip-item" :data-id="rawData.length + 1">
            <div class="add-venue" @click="changePage">
              <span>+ æ–°å¢æ™¯é»</span>
            </div>
          </div>
        </div>
      </div>
      <div class="create-venu-box" v-show="page == 'CreateBox'">
        <div class="create-venu-tab">
          <div class="trip-list-header-back create-venu-tab-back" @click.prevent="changePage">
            <a href="" class="m-0"></a>
          </div>
          <div class="create-venu-tab-search" @click="selectTab = 'search'"
            :style="{'borderBottom': selectTab == 'search' ? '4px solid #ee3c77 ' : 'none'}">
            <i class="fas fa-search" :style="{'color': selectTab == 'search' ? '#ee3c77' : '#666'}"></i>
            <span>æœå°‹</span>
          </div>
          <div class="create-venu-tab-collection" @click="selectTab = 'collection'"
            :style="{'borderBottom': selectTab == 'collection' ? '4px solid #ee3c77 ' : 'none'}">
            <i class="fas fa-map-marker-alt" :style="{'color': selectTab == 'collection' ? '#ee3c77' : '#666'}"></i>
            <span>æ™¯é»æ”¶è—</span>
          </div>
        </div>
        <label for="" style="position: relative;" v-if="selectTab == 'search'">
          <i class="fas fa-map-marker-alt"
            style="position: absolute; top: 33px; left: 18px; color: #666; font-size: 18px;"></i>
          <input type="text" ref="searchBox" placeholder="è«‹è¼¸å…¥æ™¯é»é—œéµå­—" class="searchBox">
        </label>

      </div>
      <div class="comments-minimized">
        <i class="far fa-comment-alt"></i>
        <div class="comments-minimized-count">
          6
        </div>
      </div>
      <place-detail @close="ShowPlaceDetail = false" v-show="ShowPlaceDetail"></place-detail>
      <div class="tool-button-wrapper">
        <div class="tool-button">
          <i class="far fa-copy trip-tools-icon mx-2"></i>
          <div>è¤‡è£½è¡Œç¨‹</div>
        </div>
        <div class="tool-button">
          <i class="far fa-share-square trip-tools-icon mx-2"></i>
          <div>åˆ†äº«</div>
        </div>
        <div class="tool-button">
          <i class="fas fa-sign-in-alt trip-tools-icon mx-2"></i>
          <div>åµŒå…¥åœ°åœ–</div>
        </div>
      </div>
      <div class="trip-tools-footer">
        <div class="trip-tools-block">
          <i class="far fa-copy trip-tools-icon"></i>
          <span class="trip-tools-content">è¤‡è£½è¡Œç¨‹</span>
        </div>
        <div class="trip-tools-block">
          <i class="far fa-share-square trip-tools-icon"></i>
          <span class="trip-tools-content">åˆ†äº«è¡Œç¨‹</span>
        </div>
        <div class="trip-tools-block">
          <i class="far fa-comment-alt trip-tools-icon"></i>
          <span class="trip-tools-content">ç•™è¨€</span>
        </div>
        <div class="trip-tools-block" @click="showTripList=!showTripList">
          <i class="fas fa-map-marked-alt trip-tools-icon"></i>
          <span class="trip-tools-content">é¡¯ç¤ºåœ°åœ–</span>
        </div>
      </div>
      <div class="modal fade" id="Time" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered d-flex justify-centent-center" style="max-width: 300px">
          <div class="modal-content">
            <div class="modal-body edit-time-box">
              <div class="start-time" style="font-size: 20px; font-weight: bold; margin-bottom: 20px;">å‡ºç™¼æ™‚é–“ï¼š</div>
              <div class="d-flex justify-content-center">
                <select class="form-select mx-1" aria-label="Default select example" v-model="selectDayTime.Type">
                  <option value="ä¸Šåˆ">ä¸Šåˆ</option>
                  <option value="ä¸‹åˆ">ä¸‹åˆ</option>
                </select>
                <select class="form-select" v-model="selectDayTime.hour">
                  <option :value="hour" v-for="hour in hours">{{hour}}</option>
                </select>
                <div class="mx-2 d-flex align-items-center">
                  <span>:</span>
                </div>
                <select class="form-select" v-model="selectDayTime.minute">
                  <option :value="minute" v-for="minute in minutes">{{minute}}</option>
                </select>
              </div>
            </div>
            <div class="modal-footer" style="border: none;">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
              <button type="button" class="btn btn-primary" style="background: #ee3c77; border: none;"
                data-bs-dismiss="modal" @click="updateDayStartTime">å®Œæˆ</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="StayTime" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered d-flex justify-centent-center" style="max-width: 280px">
          <div class="modal-content">
            <div class="modal-body edit-time-box">
              <div class="start-time" style="font-size: 20px; font-weight: bold; margin-bottom: 20px;">åœç•™æ™‚é–“ï¼š</div>
              <div class="d-flex justify-content-center">
                <!-- <select class="form-select" v-model="selectDayTime.hour">
                  <option :value="hour" v-for="hour in stayHour">{{hour}}</option>
                </select> -->
                <el-select v-model="selectPlaceStayTime.hour" style="width: 100%;">
                  <el-option v-for="hour in stayHour" :key="hour" :label="hour" :value="hour"></el-option>
                </el-select>
                <div class="d-flex align-items-center w-50 justify-content-center">
                  <span>å°æ™‚:</span>
                </div>
                <el-select v-model="selectPlaceStayTime.minute" style="width: 100%;">
                  <el-option v-for="minute in stayMinute" :key="minute" :label="minute" :value="minute"></el-option>
                </el-select>
                <div class="ms-1 d-flex align-items-center justify-content-center">
                  <span>åˆ†</span>
                </div>
              </div>
            </div>
            <div class="modal-footer pt-0" style="border: none;">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
              <button type="button" class="btn btn-primary" style="background: #ee3c77; border: none;"
                data-bs-dismiss="modal" @click="updatePlaceStayTime">å®Œæˆ</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <template id="Card">
    <div class="place-card"
      style="font-size: 12px; transform: translateY(0px); background-color: #fff; transition-duration: 10ms">
    </div>
  </template>
  <template id="gps">
    <div class="gps">
      <div class="gps-content">
        <div class="gps-mode-car">
          <img src="/image/car.png" alt="" class="h-100">
        </div>
        <div class="gps-time">
          ç´„
          <span>7åˆ†</span>
        </div>
        <div class="gps-go ms-auto">
          <i class="fas fa-angle-double-right"></i>
        </div>
      </div>
    </div>
  </template>
  <template id="dayCard">
    <div class="day-card"></div>
  </template>
  <script>
    const placeDetail = {
      data() {
        return {
          selectTab: ''
        }
      },
      methods: {
        updateSelectTab(select) {
          this.selectTab = select
        },
        Close() {
          this.$emit('close')
        }
      },
      emits: ['close'],
      template: `<section class="card">
                <div class="close-place-card" @click="Close">
                  <i class="fas fa-times" ></i>
                </div>
                <div class="create-venu-tab">
                  <div class="create-venu-tab-search" @click="updateSelectTab('search')"
                :style="{'borderBottom': selectTab == 'search' ? '4px solid #ee3c77 ' : 'none'}">
                  <i class="fas fa-map-marker-alt" :style="{'color': selectTab == 'search' ? '#ee3c77' : '#666'}"></i>
                  <span>æœå°‹</span>
                </div>
                <div class="create-venu-tab-collection" @click="updateSelectTab('note')"
                  :style="{'borderBottom': selectTab == 'note' ? '4px solid #ee3c77 ' : 'none'}">
                  <i class="far fa-clipboard" :style="{'color': selectTab == 'note' ? '#ee3c77' : '#666'}"></i>
                  <span>æ–‡å­—ç­†è¨˜</span>
                </div>
                </div>
                  <div class="scroll-box mt-2">
                    <h1 class="name">@Model.result.name</h1>
                    <div class="location-photo w-100">
                      <div style="--swiper-navigation-color: #fff; --swiper-pagination-color: #fff" class="swiper mySwiper2">
                        <div class="swiper-wrapper">
                          <div class="swiper-slide">
                            <img src="@item.Url" />
                          </div>
                        </div>
                      </div>
                      <div thumbsSlider="" class="swiper mySwiper">
                        <div class="swiper-wrapper">
                          <div class="swiper-slide">
                            <img src="@item.Url" />
                          </div>
                        </div>
                        <div class="swiper-button-next" style="color:white;"></div>
                        <div class="swiper-button-prev" style="color:white;"></div>
                      </div>
                    </div>
                    <div class="location-info">
                      <div class="location-info-suggest">
                        <i class="fas fa-clock"></i>
                        <p class="mb-auto ms-1">å»ºè­°åœç•™ 1 å°æ™‚ 30 åˆ†é˜</p>
                      </div>
                      <ul>
                        <li class="d-flex align-items-center">
                          <i class="fas fa-map-marker-alt"></i>
                          <p class="mb-auto ms-1">@Model.result.formatted_address</p>
                        </li>
                        <li class="d-flex align-items-center">
                          <i class="fas fa-store"></i>
                          @if (Model.result.opening_hours.open_now)
                          {
                          <p class="mb-auto ms-1">é–‹æ”¾ä¸­</p>
                          }
                          else
                          {
                          <p class="mb-auto ms-1">é—œé–‰ä¸­</p>
                          }
                          <p class="mb-auto mx-1">11:00 - 21:30</p>
                          <i class="fas fa-sort-down" id="timeShow"></i>
                        </li>
                        <!--apiæŠ“åˆ°ä»Šå¤©çš„æ—¥æœŸç§»è‡³åœ¨æœ€ä¸Šé¢ åˆ°æ™‚ç”¨templateå»º------------------>
                        <ul id="timeList">
                          @foreach (var item in Model.result.opening_hours.weekday_text)
                          {
                          <li class="d-flex align-items-center">
                            <p class="mb-auto ms-1">@item</p>
                          </li>
                          }

                          @*<li class="d-flex align-items-center">
                            <p class="mb-auto ms-1">æ˜ŸæœŸä¸€</p>
                            <p class="mb-auto mx-1">11:00 - 21:30</p>
                          </li>*@

                        </ul>
                        <!--apiæŠ“åˆ°ä»Šå¤©çš„æ—¥æœŸç§»è‡³åœ¨æœ€ä¸Šé¢ åˆ°æ™‚ç”¨templateå»º------------------------------------------------- -->
                        <li class="d-flex align-items-center">
                          <i class="fas fa-globe-americas"></i>
                          <a href="@Model.result.website" class="mb-auto ms-1">@Model.result.website</a>
                        </li>
                        <li class="d-flex align-items-center">
                          <i class="fas fa-phone-alt"></i>
                          <p class="mb-auto ms-1">+88635892352</p>
                        </li>
                      </ul>
                    </div>
                    <div class="relations w-100">
                      <div class="relations-content">
                        <h2>è©•è«–</h2>
                        <div class="relations-content-wrap" style="padding-top:0;">
                          <a href="">
                            <div class="comment-progress">

                              <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0"
                                  aria-valuemax="100"></div>
                              </div>
                              <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0"
                                  aria-valuemax="100"></div>
                              </div>
                              <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0"
                                  aria-valuemax="100"></div>
                              </div>
                              <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0"
                                  aria-valuemax="100"></div>
                              </div>
                              <div class="progress">
                                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                </div>
                              </div>
                            </div>
                            <div class="relations-image review">
                              <span id="review-score">@Model.result.rating</span>
                              <ul class="d-flex text-decoration-none review-star">

                                @for (var i = 0; i < rating; i++) { <li>
                                  <i class="fas fa-star"></i>
                                  </li>
                                  }
                                  @for (var j = 0; j < (5 - rating); j++) { <li>
                                    <i class="fas fa-star" style="color:lightgrey;"></i>
                                    </li>

                                    }
                              </ul>
                              <span id="review-amount">@Model.result.reviews.Length å€‹è©•è«–</span>
                            </div>
                          </a>
                          @foreach (var item in Model.result.reviews)
                          {
                          <div class="relations-footer review-footer mt-3">
                            <a href="">
                              <img src="@item.profile_photo_url" alt="">
                            </a>
                            <p>@item.text</p>
                          </div>
                          }

                        </div>
                      </div>
                    </div>
                    <div class="relations w-100">
                      <div class="relations-content">
                        <h2>æ—…éŠå›æ†¶</h2>
                        <div class="relations-content-wrap">
                          <a href="">
                            <div class="relations-text">
                              <h3>å…¶å¯¦æ–°ç«¹å¾ˆå¥½ç©ï½œä¸çŸ¥é“æ–°ç«¹è¦å»å“ªè£¡çš„çœ‹é€™è£¡</h3>
                              <p>
                                æ–°ç«¹æ¯åˆ°äº†ç§‹å†¬å°±æ˜¯æŸ¿å­çš„å­£ç¯€ï½çœ‹åˆ°å¥½å¤šäººä¾†åˆ°é€™è£¡èˆ‡ä¸€æ•´ç‰‡é‡‘é»ƒè‰²çš„æŸ¿å­åˆç…§ï¼Œå®³æˆ‘ä¹Ÿæƒ³ä¾†ï¼Œä¾†åˆ°æ–°ç«¹ä¸çŸ¥é“è¦å»å“ªçš„è©±ï½é¸æ“‡é€™è£¡å°±å°äº†ğŸ’¯ğŸ’–-ğŸ’™FBï¼šhttps://www.facebook.com/iamclaireyoung
                                ğŸ’œIGï¼šhttps://www.instagram.com/_claireyoung/
                              </p>
                            </div>
                            <div class="relations-image">
                              <img src="~/Assets/images/map/orange.png" alt="">
                            </div>
                          </a>
                          <div class="relations-footer">
                            <a href="">
                              <img src="~/Assets/images/map/person1.jpg" alt="">
                              <span>Claire</span>
                            </a>
                            <span class="px-1"> | </span>
                            <span>2020/11/03</span>
                          </div>
                        </div>

                        <div class="relations-content-wrap">
                          <a href="">
                            <div class="relations-text">
                              <h3>å…¶å¯¦æ–°ç«¹å¾ˆå¥½ç©ï½œä¸çŸ¥é“æ–°ç«¹è¦å»å“ªè£¡çš„çœ‹é€™è£¡</h3>
                              <p>
                                æ–°ç«¹æ¯åˆ°äº†ç§‹å†¬å°±æ˜¯æŸ¿å­çš„å­£ç¯€ï½çœ‹åˆ°å¥½å¤šäººä¾†åˆ°é€™è£¡èˆ‡ä¸€æ•´ç‰‡é‡‘é»ƒè‰²çš„æŸ¿å­åˆç…§ï¼Œå®³æˆ‘ä¹Ÿæƒ³ä¾†ï¼Œä¾†åˆ°æ–°ç«¹ä¸çŸ¥é“è¦å»å“ªçš„è©±ï½é¸æ“‡é€™è£¡å°±å°äº†ğŸ’¯ğŸ’–-ğŸ’™FBï¼šhttps://www.facebook.com/iamclaireyoung
                                ğŸ’œIGï¼šhttps://www.instagram.com/_claireyoung/
                              </p>
                            </div>
                            <div class="relations-image">
                              <img src="~/Assets/images/map/Travel-Destinations.jpg" alt="">
                            </div>
                          </a>
                          <div class="relations-footer">
                            <a href="">
                              <img src="~/Assets/images/map/person2.jpg" alt="">
                              <span>Claire</span>
                            </a>
                            <span class="px-1"> | </span>
                            <span>2020/11/03</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="button-group">
                      <button class="button ms-auto" id="button-collect">åŠ å…¥æ”¶è—</button>
                      <button class="button ms-auto" id="button-addtrip">åŠ å…¥è¡Œç¨‹</button>
                    </div>
                  </div>
              </section>`
    }
    const dayCell = {
      props: ['tripData', 'selectDay', 'edit'],
      emits: ['deleteData'],
      template: `
        <div class="day-cell" :class="{'HighlightDay': tripData.Date == selectDay.Date, 'edit-mode': edit}">
          <div class="drag-handler" v-if="edit"></div>
          <div class="day-cell-content">
            <span :style="{fontWeight: tripData.Date == selectDay.Date ? 900 : 400}"  class="pt-1">{{tripData.Date}}</span>
            <span class="day-number">ç¬¬{{tripData.Day}}å¤©</span>
            <div class="delete" @click="deleteData" v-if="edit">
              <i class="fas fa-trash delete-tool"></i>
            </div>
          </div>
        </div>`,
      methods: {
        deleteData() {
          this.$emit('deleteData', this.tripData)
        }
      }
    }
    const day = {
      template: `
      <header class="trip-list-day-header">
        <div class="text-white weekday" :style="{background: (showDay.content !== tripContent) && showDay.show  ? '#888' : tripContent.Color}" style="cursor: pointer" @click="selectDay" >
          <div class="d-inline-block eye" v-if="showDay.show">
            <i class="far fa-eye" v-if="showDay.content == tripContent"></i>
            <i class="far fa-eye-slash" v-else></i>
          </div>
          <span>ç¬¬{{tripContent.Day}}å¤©ï¼š{{tripContent.Weekday}}</span>
        </div>
        <div class="trip-list-day-header-time">
          å‡ºç™¼æ™‚é–“ï¼š
          <b class="edit-mode" data-bs-toggle="modal" data-bs-target="#Time" v-if="edit" @click="selectTime">{{tripContent.StartTime}}</b>
          <b v-else >{{tripContent.StartTime}}</b>
        </div>
      </header>`,
      props: ['tripContent', 'showDay', 'edit'],
      emits: ['selectDay', 'selectTime'],
      methods: {
        selectDay() {
          this.$emit('selectDay', this.tripContent)
          console.log(this.tripContent);

        },
        selectTime() {
          this.$emit('selectTime', this.tripContent)
        }
      }
    }
    const placeGps = {
      template: `
      <div class="trip-list-venu-container" :class="{'edit': edit}">
        <div class="drag-handler" v-if="edit"></div>
        <div class="trip-list-day-venu-time" @click="ShowPlace(tripContent.PlaceName)">
          <span class="trip-list-day-venu-time-from">{{tripContent.StartTime}}</span>
          <span class="fas fa-map-marker trip-list-day-venu-number-mark" :style="{color: tripContent.Color}">
            <span class="trip-list-day-venu-number">{{tripContent.Sequence}}</span>
          </span>
          <span class="trip-list-day-venu-time-to">{{tripContent.EndTime}}</span>
        </div>
        <div class="trip-list-day-venu-info">
          <div class="trip-list-day-venu-info-detail" @click="ShowPlace(tripContent.PlaceName)">
            <div class="trip-list-day-venu-info-time" @click=Show>
              <i class="fas fa-clock" style= "color: #888;" v-if="!edit"></i>
              <span class="edit-mode" data-bs-toggle="modal" data-bs-target="#StayTime" v-if="edit" @click="selectStayTime">{{tripContent.StayTime}}</span>
              <span v-else class="ms-1">{{tripContent.StayTime}}</span>
            </div>
            <div class="trip-list-day-venu-info-name">{{tripContent.PlaceName}}</div>
            <div class="trip-list-day-venu-info-address">{{tripContent.Address}}</div>
          </div>
          <div class="trip-list-day-venu-info-edit">
            <div class="position-relative" v-if="edit">
              <i class="far fa-copy copy-tool" @click="$emit('copyData', tripContent)"></i>
              <div class="trip-list-day-venu-info-edit-func">è¤‡è£½</div>
            </div>
            <div class="position-relative" @click="deletePlace" v-if="edit">
              <i class="fas fa-trash delete-tool"></i>
              <div class="trip-list-day-venu-info-edit-func">åˆªé™¤</div>
            </div>
            <div @click="ShowPlace(tripContent.PlaceName)">
              <i class="fas fa-file-alt" style="font-size: 20px; color: #666;" v-if="!edit"></i>
            </div>
          </div>
        </div>
      </div>
      <div v-if="tripContent.Car">
        <div class="gps">
          <div class="gps-content">
            <div class="gps-mode-car">
              <img src="/image/car.png" alt="" class="h-100">
            </div>
            <div class="gps-time">
              ç´„
              <span>{{tripContent.Car}}</span>
            </div>
            <div class="gps-go ms-auto">
              <i class="fas fa-directions"></i>
            </div>
          </div>
        </div>
      </div>`,
      // template: `<p>{{tripContent.Day}}</p>`,
      props: ['tripContent', 'edit'],
      emits: ['copyData', 'deletePlace', 'selectPlace', 'selectStayTime'],
      methods: {
        Show() { },
        deletePlace() {
          this.$emit('deletePlace', this.tripContent)
        },
        ShowPlace(Place) {
          if (!this.edit) {
            this.$emit('selectPlace', Place)
          }
        },
        selectStayTime() {
          this.$emit('selectStayTime', this.tripContent)
        }
      },
    }

    const dayPlus = {
      data() {
        return {
          show: ''
        }
      },
      template: `
      <div class="add-venue" style="margin-top: 16px;" @click="$emit('AddPlace')">
        <span>+ æ–°å¢æ™¯é»</span>
      </div>
      <header class="trip-list-day-header">
        <div class="text-white weekday" style="cursor: pointer;" :style="{background: (showDay.content !== tripContent) && showDay.show ? '#888' : tripContent.Color}" @click="selectDay">
          <div class="d-inline-block eye" v-if="showDay.show">
            <i class="far fa-eye" v-if="showDay.content == tripContent"></i>
            <i class="far fa-eye-slash" v-else></i>
          </div>
          <span>ç¬¬{{tripContent.Day}}å¤© : {{tripContent.Weekday}}</span>
        </div>
        <div class="trip-list-day-header-time">
          å‡ºç™¼æ™‚é–“ï¼š
          <b class="edit-mode" data-bs-toggle="modal" data-bs-target="#Time" v-if="edit" @click="selectTime">{{tripContent.StartTime}}</b>
          <b v-else>{{tripContent.StartTime}}</b>
        </div>
      </header>`,
      props: ['tripContent', 'showDay', 'edit'],
      emits: ['selectDay', 'selectTime', 'AddPlace'],
      methods: {
        selectDay() {
          this.$emit('selectDay', this.tripContent)
        },
        selectTime() {
          console.log(this.tripContent.StartTime);
          this.$emit('selectTime', this.tripContent)
        }
      }
    }

    const App = {
      data() {
        return {
          urls: {
            url_UpdatePlaceStayTime: "https://localhost:44392/api/plan/UpdatePlaceStayTime",
          },
          ShowPlaceDetail: false,
          searchBox: '',
          selectTab: '',
          page: 'TripList',
          initialLoading: false,
          Loading: false,
          hours: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
          minutes: ['00', '05', '10', '15', '20', '25', '30', '35', '40', '45', '50', '55'],
          stayMinute: Array.from(Array(60).keys()),
          stayHour: Array.from(Array(24).keys()),
          showSpecificRoute: {
            show: false,
            content: {}
          },
          originDayTime: {
            Type: '',
            DayId: '',
            hour: '',
            minute: ''
          },
          selectDayTime: {
            Type: '',
            DayId: '',
            hour: '',
            minute: ''
          },
          originPlaceStayTime: {
            DayId: '',
            TripDetailId: '',
            hour: '',
            minute: '',
          },
          selectPlaceStayTime: {
            DayId: '',
            TripDetailId: '',
            hour: '',
            minute: '',
          },
          StartDate: '',
          EndDate: '',
          StartDateDisplay: '',

          tripListHeight: '',
          edit: false,
          setReturn: false,
          showTripList: true,
          map: '',
          directionsService: '',
          directionsRenderersData: [],
          markersData: [],
          placeCard: '',

          dayContainer: '',
          dayItems: '',
          selectDay: '',
          dayCard: '',

          ScrollOption: {
            left: '',
            behavior: 'smooth'
          },
          x: 0,
          interval_x: '',
          clientX: 0,
          selectRight: 0,
          selectLeft: 0,

          tripItems: [],
          tripContainer: '',
          y: 0,
          interval_y: '', // é¼ æ¨™ç§»å‹•çš„è·é›¢
          clientY: 0, // ä¹‹å‰çš„æ»‘é¼ é¼ æ¨™ä½ç½®
          selectBottom: 0, // é¸å®šå€åŸŸçš„åº•éƒ¨
          selectTop: 0, // é¸å®šå€åŸŸçš„é ‚éƒ¨
          H: 0, // åˆ¤æ–·æ˜¯å¦è¦ç§»å‹•çš„å¡ç‰‡é«˜åº¦ï¼Œup (id - 1)ï¼›down (id + 1)

          ChangeData: {
            old: '',
            new: ''
          },
          clickTag: '',
          mouseMove: '',
          steps: [],
          mouseDirection: '',
          scrollDirection: '',
          totalD: '', // trip-list-day-containerçš„é«˜åº¦
          selectD: '', // é¸å®šæ¼‚æµ®å€å¡Šè·é›¢trip-listä¸Šæ–¹çš„é«˜åº¦
          selectL: '', // é¸å®šå€å¡Šçš„é«˜åº¦ (translateYçš„è·é›¢)
          stopCardMove: '', // æ¼‚æµ®å€å¡Šåœæ­¢ç§»å‹•ï¼Œå·è»¸é–‹å§‹ç§»å‹•
          stopScroll: '', // åœæ­¢Scroll barç§»å‹•
          timeId: 0, // TimeInterval Id
          scrollTarget: '', // scroll barç§»å‹•çš„ç›®æ¨™çµ‚é»
          scrollInterval: '', // scroll barç§»å‹•è·é›¢
          currentId: '', // ç›®å‰é¸å®šçš„ID
          clickId: '',
          rawData: {}
        }
      },
      methods: {
        updateSelectTab(select) {
          this.selectTab = select;
        },
        // --- åˆ‡æ›åˆ†é  ---
        changePage() {
          if (this.page == 'TripList') {
            this.page = 'CreateBox'
            this.selectTab = 'search'
          }
          else {
            this.page = 'TripList'
          }
        },
        // --- å–å¾—Planè³‡æ–™ ---
        getData() {
          this.initialLoading = true
          let url = "https://raw.githubusercontent.com/r04941090/FileStorage/master/Trip"
          let url2 = "https://localhost:44392/api/plan/GetPlanDetails/44"
          axios.get(url2).then(res => {
            console.log('RawData', res);
            this.rawData = res.data
            this.rawDataOnlyDay = this.rawData.TripContent.filter(x => x.Type == 'Day')
            let StartDateAry = this.rawData.StartDate.split('-')
            let EndDateAry = this.rawData.EndDate.split('-')
            this.StartDate = this.rawData.StartDate
            this.StartDateDisplay = `${StartDateAry[0]}å¹´${StartDateAry[1]}æœˆ${StartDateAry[2]}æ—¥`
            this.EndDate = `${EndDateAry[0]}å¹´${EndDateAry[1]}æœˆ${EndDateAry[2]}æ—¥`
            let result = JSON.parse(JSON.stringify(this.rawData.TripContent))
            this.calculateRoute(result)
          }).catch(error => {
            console.log(error);
            axios.get(url).then(res => {
              this.rawData = res.data
              this.rawDataOnlyDay = this.rawData.TripContent.filter(x => x.Type == 'Day')
              let StartDateAry = this.rawData.StartDate.split('-')
              let EndDateAry = this.rawData.EndDate.split('-')
              this.StartDate = this.rawData.StartDate
              this.StartDateDisplay = `${StartDateAry[0]}å¹´${StartDateAry[1]}æœˆ${StartDateAry[2]}æ—¥`
              this.EndDate = `${EndDateAry[0]}å¹´${EndDateAry[1]}æœˆ${EndDateAry[2]}æ—¥`
              this.calculateRoute(this.rawData.TripContent)
            })
          })
        },
        // --- æ‰“é–‹æ™¯é»é é¢ ---
        ShowPlacePage(Place) {
          this.ShowPlaceDetail = true;
        },
        // --- æ”¹è®Šå‡ºç™¼æ™‚é–“ï¼Œä¸¦ä¸”é‡æ–°è¨ˆç®—æ™‚é–“ ---
        updateDayStartTime() {

          if ((this.originDayTime.hour !== this.selectDayTime.hour) || (this.originDayTime.minute !== this.selectDayTime.minute)) {
            if (this.selectDayTime.Type == 'ä¸‹åˆ') {
              this.selectDayTime.hour = this.selectDayTime.hour + 12
            }
            let selectIndex = this.rawData.TripContent.findIndex(x => x.DayId == this.selectDayTime.DayId && x.Type == 'Day')
            let origin_hour = parseInt(this.rawData.TripContent[selectIndex].StartTime.split(':')[0])
            let origin_minute = parseInt(this.rawData.TripContent[selectIndex].StartTime.split(':')[1])
            let diff = (this.selectDayTime.hour * 60 + parseInt(this.selectDayTime.minute)) - (origin_hour * 60 + origin_minute)
            this.rawData.TripContent.forEach(item => {
              if (item.DayId == this.selectDayTime.DayId) {
                let start_hour = parseInt(item.StartTime.split(':')[0])
                let start_minute = parseInt(item.StartTime.split(':')[1])
                let start_totalMinute = ((start_hour * 60) + start_minute) + diff
                item.StartTime = `${(Math.floor(start_totalMinute / 60)).toString().padStart(2, '0')}:${(start_totalMinute % 60).toString().padStart(2, '0')}`
                if (item.Type == 'Place') {
                  // åªæœ‰Typeç‚ºPlaceæ‰æœ‰EndTime
                  let end_hour = parseInt(item.EndTime.split(':')[0])
                  let end_minute = parseInt(item.EndTime.split(':')[1])
                  let end_totalMinute = ((end_hour * 60) + end_minute) + diff
                  item.EndTime = `${(Math.floor(end_totalMinute / 60)).toString().padStart(2, '0')}:${(end_totalMinute % 60).toString().padStart(2, '0')}`
                }
              }
            })
          }
        },
        // --- æ”¹è®Šæ™¯é»åœç•™æ™‚é–“ï¼Œä¸¦ä¸”é‡æ–°è¨ˆç®—æ™‚é–“ ---
        updatePlaceStayTime() {
          if ((this.originPlaceStayTime.hour !== this.selectPlaceStayTime.hour) || (this.originPlaceStayTime.minute !== this.selectPlaceStayTime.minute)) {
            let selectIndex = this.rawData.TripContent.findIndex(x => x.TripDetailId == this.selectPlaceStayTime.TripDetailId && x.Type == 'Place')
            let origin = this.parseStayTime(this.rawData.TripContent[selectIndex])
            let origin_hour = origin.stay_hour
            let origin_minute = origin.stay_minute
            let diff = (this.selectPlaceStayTime.hour * 60 + parseInt(this.selectPlaceStayTime.minute)) - (origin_hour * 60 + origin_minute)
            let start = false
            this.rawData.TripContent.forEach(item => {
              if (item.DayId == this.selectPlaceStayTime.DayId) {
                if (start) {
                  console.log(item);
                  let start_hour = parseInt(item.StartTime.split(':')[0])
                  let start_minute = parseInt(item.StartTime.split(':')[1])
                  let start_totalMinute = ((start_hour * 60) + start_minute) + diff
                  item.StartTime = `${(Math.floor(start_totalMinute / 60)).toString().padStart(2, '0')}:${(start_totalMinute % 60).toString().padStart(2, '0')}`
                  if (item.Type == 'Place') {
                    // åªæœ‰Typeç‚ºPlaceæ‰æœ‰EndTime
                    let end_hour = parseInt(item.EndTime.split(':')[0])
                    let end_minute = parseInt(item.EndTime.split(':')[1])
                    let end_totalMinute = ((end_hour * 60) + end_minute) + diff
                    item.EndTime = `${(Math.floor(end_totalMinute / 60)).toString().padStart(2, '0')}:${(end_totalMinute % 60).toString().padStart(2, '0')}`
                  }
                }
                if (item.TripDetailId == this.selectPlaceStayTime.TripDetailId) {
                  // ç®—åˆ°è‡ªå·±æ‰é–‹å§‹ï¼Œä¸¦ä¸”æ›´æ–°è‡ªå·±çš„StayTime
                  if (this.selectPlaceStayTime.hour == 0 && this.selectPlaceStayTime.minute == 0) {
                    item.StayTime = '0ç§’'
                  }
                  else if (this.selectPlaceStayTime.hour == 0) {
                    item.StayTime = `${this.selectPlaceStayTime.minute}åˆ†`
                  }
                  else if (this.selectPlaceStayTime.minute == 0) {
                    item.StayTime = `${this.selectPlaceStayTime.hour}å°æ™‚`
                  }
                  else {
                    item.StayTime = `${this.selectPlaceStayTime.hour}å°æ™‚ ${this.selectPlaceStayTime.minute}åˆ†`
                  }
                  let end_hour = parseInt(item.EndTime.split(':')[0])
                  let end_minute = parseInt(item.EndTime.split(':')[1])
                  let end_totalMinute = ((end_hour * 60) + end_minute) + diff
                  item.EndTime = `${(Math.floor(end_totalMinute / 60)).toString().padStart(2, '0')}:${(end_totalMinute % 60).toString().padStart(2, '0')}`
                  start = true
                }
              }
            })
          }
        },
        // æ›´æ”¹æ™¯é»çš„åœç•™æ™‚é–“
        selectStayTime(select) {
          let stayTimeResult = this.parseStayTime(select)
          this.selectPlaceStayTime.DayId = select.DayId
          this.selectPlaceStayTime.TripDetailId = select.TripDetailId
          this.selectPlaceStayTime.hour = stayTimeResult.stay_hour
          this.selectPlaceStayTime.minute = stayTimeResult.stay_minute
          // è¤‡è£½ä¸€ä»½ï¼Œç”¨æ–¼æ¯”è¼ƒæ˜¯å¦ä¿®æ”¹
          this.originPlaceStayTime = { ...this.selectPlaceStayTime }
        },
        // æ›´æ”¹å‡ºç™¼æ™‚é–“
        selectTime(select) {
          let selectTime = select.StartTime.split(':')
          let hour = selectTime[0]
          let minute = selectTime[1]
          if (parseInt(hour) - 12 < 0) {
            this.selectDayTime.Type = 'ä¸Šåˆ'
          }
          else {
            this.selectDayTime.Type = 'ä¸‹åˆ'
          }
          this.selectDayTime.DayId = select.DayId
          this.selectDayTime.hour = parseInt(hour)
          this.selectDayTime.minute = minute.toString()
          // è¤‡è£½ä¸€ä»½ï¼Œç”¨æ–¼æ¯”è¼ƒæ˜¯å¦ä¿®æ”¹
          this.originDayTime = { ...this.selectDayTime }
        },
        // åˆ¤æ–·æ˜¯å¦é¡¯ç¤ºè·¯ç·š
        selectDayMethod(select) {
          if (this.rawData.TripContent.find(x => x.Day == select.Day && x.Type == 'Place') !== undefined) {
            if (this.showSpecificRoute.content == '') {
              this.showSpecificRoute.content = select
              this.showSpecificRoute.show = true
            }
            else {
              if (this.showSpecificRoute.content == select) {
                this.showSpecificRoute.content = ''
                this.showSpecificRoute.show = false
              }
              else {
                this.showSpecificRoute.content = select
                this.showSpecificRoute.show = true
              }
            }
            this.ResetRoute(this.map);
          }
        },
        // åˆªé™¤æ™¯é»
        getDeletePlace(place) {
          console.log(place);
        },
        DragMouseDown(e) {
          this.clickTag = e.target.parentNode.parentNode
          this.tripItems = document.querySelectorAll('.trip-item');
          document.querySelector('.trip-list-header-info');

          // console.dir(this.$refs.tripList)
          // console.dir(document.querySelector('.trip-list-header-info'));
          // console.dir(document.querySelector('.trip-list-header-day-container'));
          // console.dir(document.querySelector('.trip-list-day-container'));

          // é»åˆ°drag-handleæ‰æœ‰ç”¨
          if (e.target.classList[0] == "drag-handler") {
            this.clickTag.style.visibility = 'hidden'
            this.clickTag.style.opacity = 0;

            let template = document.querySelector('#Card');
            cloneNode = template.content.cloneNode(true)
            this.placeCard = cloneNode.querySelector('.place-card')

            // https://emn178.pixnet.net/blog/post/95297028
            let top = this.clickTag.offsetTop + this.$refs.tripList.offsetTop - this.tripContainer.scrollTop + 'px';

            // è¦åŠ ä¸Šç›®å‰scroll barçš„é«˜åº¦
            // https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect
            let left = this.clickTag.offsetLeft + this.$refs.tripList.offsetLeft + 'px'
            let width = this.clickTag.clientWidth + 2 + 'px'
            let dataID = this.clickTag.dataset.id
            // å°‡ç›®å‰é»é¸çš„å…ƒä»¶è³‡è¨Šæ”¾å…¥templateä¸­
            this.placeCard.style.top = top
            this.placeCard.style.left = left
            this.placeCard.style.width = width
            this.placeCard.dataset.id = dataID
            this.currentId = dataID
            this.placeCard.style['z-index'] = 99
            this.placeCard.innerHTML = this.clickTag.innerHTML

            // åˆå§‹åŒ–åƒæ•¸
            this.scrollTarget = this.tripContainer.scrollTop
            console.log(this.tripContainer.scrollTop);

            this.selectL = this.clickTag.clientHeight // é¸å®šå¡ç‰‡çš„é«˜åº¦
            // offsetTop(ç‚ºé¸å®šç‰©ä»¶ "é ‚éƒ¨" åˆ°çˆ¶å±¤ "é ‚éƒ¨" çš„è·é›¢) + offsetHeightç‚ºé¸å®šç‰©ä»¶åˆ°çˆ¶å±¤ "é ‚éƒ¨" çš„è·é›¢
            // SelectH = offsetTop - ä¸Šé¢å…©å¡Šçš„é«˜åº¦
            console.log(this.clickTag.offsetTop);

            this.selectD = this.clickTag.offsetTop - this.$refs.tripListHeaderDayContainer.clientHeight - this.$refs.tripListHeaderInfo.clientHeight + this.selectL - this.tripContainer.scrollTop
            console.log('é¸å®šç‰©ä»¶åº•éƒ¨åˆ°çˆ¶å±¤é ‚éƒ¨çš„è·é›¢', this.selectD);

            this.totalD = this.tripContainer.offsetHeight; // trip-list-day-containerçš„é«˜åº¦
            this.H = this.tripContainer.querySelector(`[data-id="${parseInt(this.currentId) + 1}"]`).offsetHeight
            this.clickId = dataID
            this.selectTop = 0
            this.selectBottom = 0
            this.clientY = 0
            this.y = 0
            this.scrollInterval = 0;
            // this.FirstId = this.tripItems[0].dataset.id
            // this.LastId = this.tripItems[this.tripItems.length - 1].dataset.id;

            this.tripContainer.appendChild(cloneNode);

            this.tripItems.forEach(trip => {
              trip.style.transform = "translateY(0px)";
            })

            window.addEventListener('mousemove', this.updateMove)
            window.addEventListener('mouseup', this.updateCard)
          }
        },
        updateCard() {
          clearInterval(this.timeId)
          this.timeId = 0
          window.removeEventListener('mousemove', this.updateMove)
          window.removeEventListener('mouseup', this.updateCard)
          this.clickTag.style.visibility = 'visible'
          this.clickTag.style.opacity = 1;

          // https://www.gushiciku.cn/pl/p9ck/zh-tw
          if (this.steps.length !== 0) {
            let itemGroups_sort = Object.values(this.tripItems).sort((a, b) => a.dataset.id - b.dataset.id)
            // tripListDayContainer.innerHTML = ''
            itemGroups_sort.forEach(trip => {
              this.tripContainer.appendChild(trip)
              trip.style = ''
              // æ¸²æŸ“ç•«é¢
            })
            // æ·±å±¤è¤‡è£½
            let result = JSON.parse(JSON.stringify(this.rawData.TripContent))
            console.log(result);
            // return
            // åªäº¤æ›æœ‰å‹•åˆ°çš„éƒ¨åˆ†
            console.log(this.steps);

            this.steps.forEach(step => {
              let newIndex = result.findIndex(x => x.Id == step.new);
              let oldIndex = result.findIndex(x => x.Id == this.clickId)
              let tempData1 = result[oldIndex]
              let tempData2 = result[newIndex]
              result[newIndex] = tempData1
              result[oldIndex] = tempData2
            })
            console.log(JSON.parse(JSON.stringify(result)));

            // return
            // æ›´æ–°Sequence
            let Day, DayId, Sequence, Color
            let Id = (this.tripItems[0].dataset.id) * 50;

            result.forEach(item => {
              if (item.Type == "Day") {
                Day = item.Day
                DayId = item.DayId
                Sequence = 0
                Color = item.Color
              }
              else {
                item.Day = Day
                item.DayId = DayId
                Sequence = Sequence + 1
                item.Sequence = Sequence
                item.Color = Color
              }
              item.Id = Id
              Id = Id + 1
            })
            this.tripItems[this.tripItems.length - 1].dataset.id = Id;
            this.Loading = true
            console.log('before');
            
            this.calculateRoute(result);
            console.log('after');
            
            this.tripItems.forEach(trip => {
              trip.style.transitionDuration = '10ms'
              trip.style.transform = "translateY(0px)"
              trip.style = ''
            })
            this.tripContainer.removeChild(this.placeCard)
          }
          else {
            // æ²’å‹•
            this.tripContainer.removeChild(this.placeCard)
            this.tripItems.forEach(trip => {
              trip.style = ''
            })
          }
          this.steps = []
          this.tripItems.forEach(trip => {
            trip.style = ''
          })
        },
        ResetRoute(map) {
          if (this.showSpecificRoute.content.Day == undefined) {
            if (this.markersData.length !== 0) {
              this.markersData.forEach(markerData => {
                markerData.marker.setVisible(true)
              })
            }
            if (this.directionsRenderersData.length !== 0) {
              this.directionsRenderersData.forEach(directionsRendererData => {
                directionsRendererData.directionsRenderer.setMap(null)
              })
              this.directionsRenderersData.forEach(directionsRendererData => {
                this.directionsService = new google.maps.DirectionsService();
                this.directionsService.route({
                  origin: {
                    query: directionsRendererData.origin
                  },
                  destination: directionsRendererData.destination,
                  waypoints: directionsRendererData.waypoint,
                  travelMode: google.maps.TravelMode.DRIVING,
                  provideRouteAlternatives: false
                }, function (res, status) {
                  directionsRendererData.directionsRenderer.setOptions({
                    map: map
                  })
                  directionsRendererData.directionsRenderer.setDirections(res);
                })
              })
            }
          }
          else {
            if (this.markersData.length !== 0) {
              this.markersData.forEach(markersData => {
                if (markersData.DayId == this.showSpecificRoute.content.DayId) {
                  markersData.marker.setVisible(true)
                }
                else {
                  markersData.marker.setVisible(false)
                }
              })
            }
            if (this.directionsRenderersData.length !== 0) {
              this.directionsRenderersData.forEach(directionsRendererData => {
                directionsRendererData.directionsRenderer.setMap(null)
              })
              this.directionsRenderersData.forEach(directionsRendererData => {
                if (directionsRendererData.DayId == this.showSpecificRoute.content.DayId) {
                  this.directionsService.route({
                    origin: {
                      query: directionsRendererData.origin
                    },
                    destination: directionsRendererData.destination,
                    waypoints: directionsRendererData.waypoint,
                    travelMode: google.maps.TravelMode.DRIVING,
                    provideRouteAlternatives: false
                  }, function (res, status) {
                    directionsRendererData.directionsRenderer.setOptions({
                      map: map
                    })
                    directionsRendererData.directionsRenderer.setDirections(res);
                  })
                }
                else {
                  directionsRendererData.directionsRenderer.setMap(null)
                }
              })
            }
          }
        },
        async calculateRoute(result) {
          // ç§»é™¤markerã€direction
          if (this.markersData.length !== 0) {
            this.markersData.forEach(markersData => {
              // marker.setIcon(null)
              // marker.setLabel(null);
              // marker.setMap(null)
              markersData.marker.setVisible(false)
            })
            this.markersData = []
          }
          if (this.directionsRenderersData.length !== 0) {
            this.directionsRenderersData.forEach(directionsRendererData => {
              directionsRendererData.directionsRenderer.setMap(null)
            })
          }
          let SortPlaceData = []
          let PlaceData = {
            DayId: '',
            Places: [],
            Color: ''
          }
          result.forEach((item, index) => {
            if (item.Type == "Day") {
              if (PlaceData.DayId !== '') {
                SortPlaceData.push(PlaceData)
                PlaceData = {
                  DayId: '',
                  Places: [],
                  Color: ''
                }
              }
              PlaceData.DayId = item.DayId
              PlaceData.Color = item.Color
            }
            else {
              PlaceData.Places.push(item.PlaceName)
              if (index == result.length - 1) {
                SortPlaceData.push(PlaceData)
              }
            }
          })
          for (let i = 0; i < SortPlaceData.length; i++) {
            if (SortPlaceData[i].Places.length > 1) {
              const res = await this.markRouteAndPlace(SortPlaceData[i], result, i)
              console.log(i, res);

            }
            else if (SortPlaceData[i].Places.length == 1) {
              const res = await this.markOnePlace(SortPlaceData[i], result, i)
              console.log(i, res);
            }
          }
          console.log('end');
          this.rawData.TripContent = JSON.parse(JSON.stringify(result))
          this.initialLoading = false
          this.Loading = false
        },
        markRouteAndPlace(item, result, i) {
          return new Promise((resolve) => {
            let loactions = {
              origin: item.Places.shift(), // ç§»é™¤ç¬¬ä¸€å€‹
              destination: item.Places.pop() // ç§»é™¤æœ€å¾Œä¸€å€‹
            }
            let WayPoints = []
            item.Places.forEach(waypoint => {
              WayPoints.push({
                location: waypoint,
                stopover: true
              })
            })
            let CalulateResult = {
              DayId: '',
              Address: [],
              CarTime: []
            }
            this.calculateAndDisplayRoute(loactions, WayPoints, item.Color, this.map, this.pinSymbol, this.markLabel, item.DayId).then(res => {
              CalulateResult.DayId = item.DayId
              res.routes[0].legs.forEach((result, index) => {
                CalulateResult.Address.push(result.start_address.slice(3, -1))
                if (index == res.routes[0].legs.length - 1) {
                  CalulateResult.Address.push(result.end_address.slice(3, -1))
                }
                CalulateResult.CarTime.push(result.duration.text)
              })
              let DayStartTime = 0
              result.filter(x => x.DayId == CalulateResult.DayId && x.Type == "Place").forEach((selected, index) => {
                selected.Address = CalulateResult.Address[index]

                if (index == 0) {
                  DayStartTime = result.filter(x => x.DayId == CalulateResult.DayId && x.Type == "Day")[0].StartTime
                }
                let StartDateAry = this.rawData.StartDate.split('-')
                let datetime = new Date(StartDateAry[0], StartDateAry[1], StartDateAry[2], DayStartTime.split(':')[0], DayStartTime.split(':')[1])

                let stayTime = this.parseStayTime(selected)

                let EndTime = new Date(datetime.getTime() + (stayTime.stay_hour * 60 + stayTime.stay_minute) * 60000)
                selected.StartTime = this.changeDateFormat(datetime)
                selected.EndTime = this.changeDateFormat(EndTime)

                if (CalulateResult.CarTime.length == index) {
                  // æœ€å¾Œä¸€å€‹æ™¯é»
                  selected.Car = ''
                  // æ—¥æœŸæ›¿æ›
                }
                else {
                  // åŠ å…¥Carçš„æ™‚é–“
                  selected.Car = CalulateResult.CarTime[index]
                  // æ—¥æœŸæ›¿æ›
                  let car_hour = 0;
                  let car_minute = 0;
                  if (CalulateResult.CarTime[index].split(' ').length == 2) {
                    // æ²’æœ‰å°æ™‚
                    car_hour = 0
                    car_minute = parseInt(CalulateResult.CarTime[index].split(' ')[0])
                  }
                  else {
                    car_hour = parseInt(CalulateResult.CarTime[index].split(' ')[0])
                    car_minute = parseInt(CalulateResult.CarTime[index].split(' ')[2])
                  }
                  let AddCarTime = new Date(datetime.getTime() + ((car_hour + stayTime.stay_hour) * 60 + (car_minute + stayTime.stay_minute)) * 60000)
                  DayStartTime = this.changeDateFormat(AddCarTime)
                }
              })
              console.log(i);
              resolve(i)
            })
          })
        },
        markOnePlace(item, result, i) {
          return new Promise(resolve => {
            let DayStartTime = result.filter(x => x.DayId == item.DayId && x.Type == "Day")[0].StartTime
            let StartDateAry = this.rawData.StartDate.split('-')
            let datetime = new Date(StartDateAry[0], StartDateAry[1], StartDateAry[2], DayStartTime.split(':')[0], DayStartTime.split(':')[1])
            let selected = result.filter(x => x.DayId == item.DayId && x.Type == "Place")[0]

            let stayTime = this.parseStayTime(selected)

            let EndTime = new Date(datetime.getTime() + ((stayTime.stay_hour) * 60 + stayTime.stay_minute) * 60000)
            selected.StartTime = this.changeDateFormat(datetime)
            selected.EndTime = this.changeDateFormat(EndTime)
            selected.Car = ''
            this.findPlace(item.DayId, item.Places[0], this.markLabel, selected, item.Color).then(res => {
              console.log(i);
              resolve(i)
            })
          })
        },
        parseStayTime(selected) {
          let stayTime = {
            stay_hour: 0,
            stay_minute: 0
          }
          if (selected.StayTime.split(' ').length == 2) {
            stayTime.stay_hour = parseInt(selected.StayTime.split(' ')[0].split('å°æ™‚')[0])
            stayTime.stay_minute = parseInt(selected.StayTime.split(' ')[1].split('åˆ†')[0])
          }
          else {
            if (selected.StayTime.includes("å°æ™‚")) {
              stayTime.stay_hour = parseInt(selected.StayTime.split('å°æ™‚')[0])
            }
            else if (selected.StayTime.includes("åˆ†")) {
              stayTime.stay_minute = parseInt(selected.StayTime.split('åˆ†')[0])
            }
          }
          return stayTime
        },
        copyPlace(place) {
          console.log(place);
          let insertIndex = this.rawData.TripContent.findIndex(x => x.Id = place.Id)
        },
        findPlace(DayId, Place, markLabel, selected, color) {
          return new Promise((resolve, reject) => {
            let request = {
              query: Place,
              fields: ['ALL']
            }
            let PlacesService = new google.maps.places.PlacesService(this.map);
            PlacesService.findPlaceFromQuery(request, function (results, status) {
              selected.Address = results[0].formatted_address.slice(3, -1)
              markLabel(DayId, results[0].geometry.location, color, "1", "900")
              resolve('success')
            })
          })

        },
        changeDateFormat(datetime) {
          let result = {
            hour: datetime.getHours().toString().padStart(2, 0),
            minute: datetime.getMinutes().toString().padStart(2, 0)
          }
          return `${result.hour}:${result.minute}`
        },

        calculateAndDisplayRoute(locations, waypoint, routeColor, map, pinSymbol, markLabel, DayId) {
          this.directionsService = new google.maps.DirectionsService();
          // A service for computing directions between two or more places.
          let directionsRenderer = new google.maps.DirectionsRenderer({
            // Renders directions obtained from the DirectionsService.
            map: map,
            suppressMarkers: true,
            // suppressPolylines: true,
            polylineOptions: {
              strokeColor: routeColor,
              strokeOpacity: 0.6,
              strokeWeight: 5
            },
          })
          // å°‡directionsRendererDataè³‡æ–™å­˜èµ·ä¾†
          let directionsRendererData = {
            directionsRenderer: directionsRenderer,
            DayId: DayId,
            origin: locations.origin,
            destination: locations.destination,
            waypoint: waypoint,
            routeColor: routeColor,
          }
          this.directionsRenderersData.push(directionsRendererData)
          return new Promise((resolve, reject) => {
            this.directionsService.route({
              origin: {
                query: locations.origin
              },
              destination: locations.destination,
              waypoints: waypoint,
              travelMode: google.maps.TravelMode.DRIVING,
              provideRouteAlternatives: false
            }, function (res, status) {

              directionsRenderer.setDirections(res);
              // draw marker
              let my_route = res.routes[0]
              let Places = []
              my_route.legs.forEach(item => {
                Places.push(item.start_location)
              })
              Places.push(my_route.legs[my_route.legs.length - 1].end_location)
              let fontWeight = 'normal'
              for (var i = 0; i < Places.length; i++) {
                if (i == 0 || i == Places.length - 1) {
                  fontWeight = '900'
                }
                else {
                  fontWeight = '400'
                }
                markLabel(DayId, Places[i], routeColor, (i + 1).toString(), fontWeight)
              }
              resolve(res)
            })
          })
        },
        markLabel(DayId, Place, color, labelText, fontWeight) {
          let map = this.map
          let icon = this.pinSymbol(color)
          let position = JSON.parse(JSON.stringify(Place))

          let label = {
            text: labelText,
            color: 'black',
            fontSize: '12px',
            fontWeight: fontWeight
          }
          let marker = new google.maps.Marker({
            position: position,
            label: label,
            map: map,
            optimized: true,
            icon: icon
          })
          let markerData = {
            marker: marker,
            DayId: DayId
          }
          this.markersData.push(markerData)
        },
        pinSymbol(color) {
          return {
            path: 'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z',
            fillColor: color,
            fillOpacity: 0.8,
            strokeColor: '#000',
            strokeWeight: 2,
            // border
            scale: 1,
            labelOrigin: new google.maps.Point(0, -29)
          };
        },
        updateMove(e) {
          this.checkMouseDirection(e)
          // æ¼‚æµ®å¡ç‰‡ç§»å‹•
          this.placeCard.style.transform = `translateY(${this.y}px)`
          if (this.mouseDirection == 'down') {
            this.selectD = this.selectD + this.interval_y  // æœ‰å¯èƒ½è¶…å‡ºç•«é¢

            // å¦‚æœæ»‘é¼ æœ‰ç§»å‹•ï¼Œå‰‡éœ€è¦ä¿®æ”¹
            // if (this.stopScroll){
            //   this.selectBottom = this.selectBottom + this.interval_y
            //   this.selectTop = this.selectTop - this.interval_y
            // }
            this.selectBottom = this.selectBottom + this.interval_y
            this.selectTop = this.selectTop - this.interval_y

            if (!this.checkTripScrollDirection()) {
              console.log('è¦ç§»å‹•çš„å€å¡Š down', this.H);
              console.log('selectBottom', this.selectBottom, 'selectTop', this.selectTop);
              // ä»£è¡¨æ²’æœ‰æ»‘å‹•åˆ°åº•éƒ¨
              if (!this.stopMove) {
                if (this.selectBottom > this.H / 2) {
                  this.changeData(this.mouseDirection)
                }
              }
            }
          }
          else if (this.mouseDirection == 'up') {
            // åœ¨åº•éƒ¨ï¼Œç„¶å¾Œscroll barå¾€ä¸‹ç§»å‹•ï¼Œä½†é¼ æ¨™æ˜¯å¾€ä¸Š
            this.selectD = this.selectD - this.interval_y

            // å¦‚æœæ»‘é¼ æœ‰ç§»å‹•ï¼Œå‰‡éœ€è¦ä¿®æ”¹
            // if (this.stopScroll) {
            //   this.selectTop = this.selectTop + this.interval_y
            //   this.selectBottom = this.selectBottom - this.interval_y
            // }
            this.selectTop = this.selectTop + this.interval_y
            this.selectBottom = this.selectBottom - this.interval_y

            if (!this.checkTripScrollDirection()) {
              console.log('è¦ç§»å‹•çš„å€å¡Š up', this.H);
              console.log('selectBottom', this.selectBottom, 'selectTop', this.selectTop);
              if (!this.stopMove) {
                if (this.selectTop > this.H / 2) {
                  this.changeData(this.mouseDirection)
                }
              }
            }
          }
        },
        addSteps() {
          if (this.steps.length !== 0) {
            // æª¢æŸ¥æ˜¯å¦ç§»å›åŸä½
            if (this.steps[this.steps.length - 1].old == this.ChangeData.new &&
              this.steps[this.steps.length - 1].new == this.ChangeData.old) {
              // ç§»é™¤æœ€å¾Œä¸€å€‹
              this.steps.pop()
            }
            else {
              this.steps.push(JSON.parse(JSON.stringify(this.ChangeData)))
            }
          }
          else {
            this.steps.push(JSON.parse(JSON.stringify(this.ChangeData)))
          }
          console.log(this.steps);
        },
        changeData(direction) {
          if (direction == 'up') {
            let changeNode = this.tripContainer.querySelector(`[data-id="${this.currentId}"]`)
            if (changeNode.style.transform == 'translateY(0px)' ||
              changeNode.style.transform == `translateY(${this.selectL}px)`) {
              let moveNode = this.tripContainer.querySelector(`[data-id="${parseInt(this.currentId) - 1}"]`)
              moveNode.style.transform = `translateY(${this.selectL}px)`
              this.currentId = parseInt(this.currentId) - 1
            }
            else if (changeNode.style.transform == `translateY(${this.selectL * (-1)}px)`) {
              let moveNode = this.tripContainer.querySelector(`[data-id="${parseInt(this.currentId)}"]`)
              moveNode.style.transform = `translateY(0px)`
              this.currentId = parseInt(this.currentId) - 1
            }
            this.stopScroll = false
            console.log('this.H', this.H);


            // if (!this.stopMove) {
            //   this.selectBottom = this.H - this.selectTop
            //   this.selectTop = (this.H - this.selectTop) * (-1)
            // }
            this.selectBottom = this.H - this.selectTop
            this.selectTop = (this.H - this.selectTop) * (-1)
            console.log('new selectTop', this.selectTop, 'new selectBottom', this.selectBottom);
            // alert('test')
            this.ChangeData.old = parseInt(this.currentId) + 1
            this.ChangeData.new = parseInt(this.currentId)
            this.addSteps();
          }
          else if (direction == 'down') {
            let changeNode = this.tripContainer.querySelector(`[data-id="${this.currentId}"]`)
            if (changeNode.style.transform == 'translateY(0px)' ||
              changeNode.style.transform == `translateY(${this.selectL * (-1)}px)`) {
              let moveNode = this.tripContainer.querySelector(`[data-id="${parseInt(this.currentId) + 1}"]`)
              moveNode.style.transform = `translateY(${this.selectL * (-1)}px)`
              this.currentId = parseInt(this.currentId) + 1
            }
            else if (changeNode.style.transform == `translateY(${this.selectL * (-1)}px)`) {
              let moveNode = this.tripContainer.querySelector(`[data-id="${parseInt(this.currentId)}"]`)
              moveNode.style.transform = `translateY(0px)`
              this.currentId = parseInt(this.currentId) + 1
            }
            this.stopScroll = false
            console.log('this.H', this.H);

            // if (!this.stopMove) {
            //   this.selectTop = this.H - this.selectBottom
            //   this.selectBottom = (this.H - this.selectBottom) * (-1)
            // }
            this.selectTop = this.H - this.selectBottom
            this.selectBottom = (this.H - this.selectBottom) * (-1)
            console.log('new selectTop', this.selectTop, 'new selectBottom', this.selectBottom);
            // alert('test')
            this.ChangeData.old = parseInt(this.currentId) - 1
            this.ChangeData.new = parseInt(this.currentId)
            this.addSteps();
          }
        },
        checkMouseDirection(e) {
          // ç›£æ¸¬é¼ æ¨™ä½ç½®
          if (this.clientY !== 0) {
            let changeNode = this.tripContainer.querySelector(`[data-id="${this.currentId}"]`)
            if (this.clientY > e.clientY) {
              this.mouseDirection = 'up'
              this.updateNextH(this.mouseDirection)
              this.interval_y = this.clientY - e.clientY
              this.y = this.y - this.interval_y
            }
            else if (this.clientY < e.clientY) {
              this.mouseDirection = 'down'
              // åˆ¤æ–·æ¥ä¸‹ä¾†è¦ç¢ºèªçš„Hã€æ˜¯å¦stopMove
              this.updateNextH(this.mouseDirection)
              this.interval_y = e.clientY - this.clientY
              this.y = this.y + this.interval_y
            }
            else {
              this.mouseDirection = 'same'
            }
          }
          // è¨˜éŒ„å‰ä¸€æ¬¡æ•¸å€¼ç”¨æ–¼ä¸‹æ¬¡æ¯”è¼ƒ
          this.clientY = e.clientY
        },
        updateNextH(direction) {
          let changeNode = this.tripContainer.querySelector(`[data-id="${this.currentId}"]`)
          if (direction == "down") {
            if (changeNode.style.transform == 'translateY(0px)' ||
              changeNode.style.transform == `translateY(${this.selectL * (-1)}px)`) {
              if (parseInt(this.currentId) + 1 == this.tripItems[this.tripItems.length - 1].dataset.id) {
                this.stopMove = true
              }
              else {
                this.stopMove = false
                this.H = this.tripContainer.querySelector(`[data-id="${parseInt(this.currentId) + 1}"]`).offsetHeight
              }
            }
            else if (changeNode.style.transform == `translateY(${this.selectL}px)`) {
              this.H = this.tripContainer.querySelector(`[data-id="${parseInt(this.currentId)}"]`).offsetHeight
              this.stopMove = false
            }
          }
          else if (direction == "up") {
            if (changeNode.style.transform == 'translateY(0px)' ||
              changeNode.style.transform == `translateY(${this.selectL}px)`) {
              if (parseInt(this.currentId) - 1 == this.tripItems[0].dataset.id) {
                this.stopMove = true
              }
              else {
                this.stopMove = false
                this.H = this.tripContainer.querySelector(`[data-id="${parseInt(this.currentId) - 1}"]`).offsetHeight
              }
            }
            else if (changeNode.style.transform == `translateY(${this.selectL * (-1)}px)`) {
              this.H = this.tripContainer.querySelector(`[data-id="${parseInt(this.currentId)}"]`).offsetHeight
              this.stopMove = false
            }
          }
        },
        scrollMove() {
          console.log('ssssss', this.stopScroll);

          // https://developer.mozilla.org/en-US/docs/Web/API/Element/scroll
          // scroll information
          if (this.scrollDirection == 'down') {
            if (!this.stopScroll) {
              this.scrollInterval = this.scrollInterval + 1
              this.scrollTarget = this.scrollTarget + this.scrollInterval
              // let option = {
              //   top: this.scrollTarget,
              //   behavior: 'auto'
              // }
              // console.log(option);

              this.tripContainer.scroll(0, this.scrollTarget)

              if (this.tripContainer.scrollTop + this.tripContainer.clientHeight >= this.tripContainer.scrollHeight) {
                // ä»£è¡¨åˆ°åº•éƒ¨
                this.stopScroll = true
                this.scrollTarget = this.tripContainer.scrollTop
                this.scrollInterval = 0
                // clearTimeInterval
                clearInterval(this.timeId)
                this.timeId = 0
              }
              else {
                this.stopScroll = false
                this.selectBottom = this.selectBottom + this.scrollInterval
                this.selectTop = this.selectTop - this.scrollInterval
                // æª¢æŸ¥ä¸‹ä¸€å€‹H
                this.updateNextH(this.scrollDirection)
                console.log(this.selectBottom, this.selectTop);

                if (!this.stopMove) {
                  if (this.selectBottom > this.H / 2) {
                    console.log(this.selectBottom, this.selectTop, this.H);
                    this.scrollInterval = 0
                    this.changeData(this.scrollDirection)
                    // alert('AAAAAA')
                  }
                }
              }
            }
          }
          else if (this.scrollDirection == 'up') {
            if (!this.stopScroll) {
              this.scrollInterval = this.scrollInterval + 1
              this.scrollTarget = this.scrollTarget - this.scrollInterval
              this.tripContainer.scroll(0, this.scrollTarget)
              if (this.tripContainer.scrollTop == 0) {
                // ä»£è¡¨åˆ°é ‚
                this.stopScroll = true
                this.scrollTarget = 0
                this.scrollInterval = 0
                // clearTimeInterval
                clearInterval(this.timeId)
                this.timeId = 0
              }
              else {
                this.stopScroll = false
                this.selectBottom = this.selectBottom - this.scrollInterval
                this.selectTop = this.selectTop + this.scrollInterval
                // æª¢æŸ¥ä¸‹ä¸€å€‹H
                this.updateNextH(this.scrollDirection)
                if (!this.stopMove) {
                  if (this.selectTop > this.H / 2) {
                    this.scrollInterval = 0
                    this.changeData(this.scrollDirection)
                  }
                }
              }
            }
          }
        },
        checkTripScrollDirection() {
          let result
          console.log(this.selectD, this.totalD);
          // console.log(this.currentDirection, 'first');

          // ç”¨éåŒæ­¥çš„æ–¹å¼è§¸ç™¼
          if (this.selectD > this.totalD) {
            // åˆ°é”trip-liståº•éƒ¨ï¼Œä¸¦ä¸”scroll baré–‹å§‹æ»‘å‹•
            if (this.tripContainer.scrollTop + this.tripContainer.clientHeight >= this.tripContainer.scrollHeight) {
              // åˆ°é”åº•éƒ¨å¾Œè¦æŠŠstopScrollæ”¹æˆtrue
              this.stopScroll = true
              this.scrollTarget = 0
              this.scrollInterval = 0
              // clearTimeInterval
              clearInterval(this.timeId)
              this.timeId = 0
              result = false
            }
            else {
              this.scrollDirection = 'down'
              this.stopScroll = false
              result = true
            }
          }
          else if (this.selectD < this.selectL) {
            // åˆ°é”trip-listé ‚éƒ¨ï¼Œä¸¦ä¸”scroll baré–‹å§‹æ»‘å‹•
            if (this.tripContainer.scrollTop == 0) {
              // åˆ°é”é ‚éƒ¨å¾Œè¦æŠŠstopScrollæ”¹æˆtrue
              this.stopScroll = true
              this.scrollTarget = 0
              this.scrollInterval = 0
              // clearTimeInterval
              clearInterval(this.timeId)
              this.timeId = 0
              result = false
            }
            else {
              this.scrollDirection = 'up'
              this.stopScroll = false
              result = true
            }
          }
          else {
            // åœæ­¢æ»¾å‹•
            this.stopScroll = true
            result = false
            if (this.stopScroll) {
              if (this.timeId !== 0) {
                clearInterval(this.timeId)
                this.timeId = 0
                console.log(this.timeId);
              }
            }
          }
          if (result) {
            if (this.timeId == 0) {
              this.timeId = setInterval(this.scrollMove, 10)
            }
          }
          return result
        },
        getDeleteData(item) {
          // get delete data
          console.log('Delete', item);
        },
        // --- å¤©æ•¸å¾€å·¦æ»‘ ---
        previous() {
          // scrollï¼š jsonplaceholder.typicode.com
          let scrollObj = this.$refs.tripListHeaderDayComponent
          this.ScrollOption.left = scrollObj.scrollLeft
          this.ScrollOption.left = this.ScrollOption.left - 70
          this.$refs.tripListHeaderDayComponent.scroll(this.ScrollOption)
        },
        // --- å¤©æ•¸å¾€å³æ»‘ ---
        next() {
          // scrollï¼š jsonplaceholder.typicode.com
          let scrollObj = this.$refs.tripListHeaderDayComponent
          this.ScrollOption.left = scrollObj.scrollLeft
          this.ScrollOption.left = this.ScrollOption.left + 70
          this.$refs.tripListHeaderDayComponent.scroll(this.ScrollOption)
        },
        AddDay() {
          console.log(this.rawData);

          // let newTotalDate = this.rawData.TotalDate + 1
          // é€å‡ºTripIdã€TotalDay -> ä¿®æ”¹Tripè¡¨æ ¼ä¸­çš„TotalDateã€å¢åŠ ä¸€æ¬„åˆ°TripDayä¸­
        },

        // --- Day Drag ---
        DayDragMouseDown(e) {
          this.clickTag = e.target.parentNode.parentNode
          this.dayContainer = this.$refs.tripListHeaderDayComponent
          this.dayItems = document.querySelectorAll('.day-item')
          // é»åˆ°drag-handleæ‰æœ‰ç”¨
          if (e.target.classList[0] == "drag-handler") {
            this.clickTag.style.visibility = 'hidden'
            this.clickTag.style.opacity = 0;
            // console.dir(document.querySelector('.trip-list-header-info'))
            // console.dir(document.querySelector('.trip-list').offsetTop)
            // console.log(document.querySelector('.trip-list-header-info').offsetHeight);

            // å»ºç«‹æ¼‚æµ®å¡ç‰‡
            let template = document.querySelector('#dayCard');
            cloneNode = template.content.cloneNode(true)
            this.dayCard = cloneNode.querySelector('.day-card')

            // https://emn178.pixnet.net/blog/post/95297028

            // å°‡ç›®å‰é»é¸çš„å…ƒä»¶è³‡è¨Šæ”¾å…¥templateä¸­
            this.dayCard.style.top = this.clickTag.offsetTop + document.querySelector('.trip-list-header-info').offsetHeight + document.querySelector('.trip-list').offsetTop + 2 + this.dayContainer.scrollTop + 'px';
            this.dayCard.style.left = this.clickTag.offsetLeft + 24 + 16 - this.dayContainer.scrollLeft + 'px'
            this.dayCard.style.width = this.clickTag.clientWidth + 'px'
            this.dayCard.style.height = this.clickTag.clientHeight + 'px'
            this.dayCard.dataset.id = this.clickTag.dataset.id
            this.clickId = this.clickTag.dataset.id
            this.currentId = this.clickId

            this.dayCard.style['z-index'] = 99
            this.dayCard.innerHTML = this.clickTag.innerHTML

            // åˆå§‹åŒ–åƒæ•¸
            this.selectL = this.clickTag.clientWidth // é¸å®šå¡ç‰‡çš„å¯¬åº¦

            // selectDç‚ºé¸å–ç‰©ä»¶çš„"å³å´"åˆ°çˆ¶å±¤"å·¦å´"çš„è·é›¢
            // this.clickTag.offsetLeft é¸å®šç‰©ä»¶åˆ°çˆ¶å±¤æœ€å·¦é‚Šçš„è·é›¢ (ä¸çœ‹scrollbar)
            // this.dayContainer.scrollLeft ä»£è¡¨çˆ¶å±¤å¾€å³æ»‘å‹•å¤šå°‘è·é›¢
            this.scrollTarget = this.dayContainer.scrollLeft
            // this.dayContainer.scrollWidth çˆ¶å±¤ç¸½å¯¬åº¦ (ä¸çœ‹scrollbarï¼ŒåŒ…å«overflowçš„éƒ¨åˆ†)
            this.totalD = this.dayContainer.offsetWidth;
            // this.dayContainer.offsetWidth çˆ¶å±¤å¯¬åº¦ (å¯è¦–å¯¬åº¦)
            this.selectD = this.clickTag.offsetLeft - this.dayContainer.scrollLeft + this.selectL

            console.dir(this.clickTag)
            console.dir(this.dayContainer);
            console.log(this.dayContainer.scrollLeft);
            console.log(this.dayContainer.scrollWidth); // å…§å®¹ç¸½å¯¬åº¦
            console.log(this.dayContainer.offsetWidth);
            console.log(this.clickTag.offsetLeft);

            this.selectLeft = 0
            this.selectRight = 0
            this.clientX = 0
            this.x = 0
            this.steps = []

            this.dayItems.forEach(dayItem => {
              dayItem.style.transform = "translateX(0px)";
            })

            this.dayContainer.appendChild(cloneNode);
            window.addEventListener('mousemove', this.updateDayMove)
            window.addEventListener('mouseup', this.updateDayCard)
          }
        },
        // --- æ›´æ–°Day ---
        updateDayCard() {
          clearInterval(this.timeId)
          this.timeId = 0
          window.removeEventListener('mousemove', this.updateDayMove)
          window.removeEventListener('mouseup', this.updateDayCard)
          this.clickTag.style.visibility = 'visible'
          this.clickTag.style.opacity = 1;
          console.log(this.clickId);

          // https://www.gushiciku.cn/pl/p9ck/zh-tw
          if (this.steps.length !== 0) {
            console.log(this.steps);

            let dayItem_sort = Object.values(this.dayItems).sort((a, b) => a.dataset.id - b.dataset.id)
            let addDay = document.querySelector('.add-day');

            dayItem_sort.forEach(item => {
              this.$refs.tripListHeaderDayComponent.insertBefore(item, addDay)
              item.style = ''
              // æ¸²æŸ“ç•«é¢
            })
            // æ·±å±¤è¤‡è£½
            let result = JSON.parse(JSON.stringify(this.rawData.TripContent))
            console.log(JSON.parse(JSON.stringify(this.rawData.TripContent)));

            // åªäº¤æ›æœ‰å‹•åˆ°çš„éƒ¨åˆ†
            this.steps.forEach(step => {
              let newDay = result.find(x => x.Day == step.new).Day
              let oldDay = result.find(x => x.Day == this.clickId).Day
              console.log(newDay, oldDay);

              let selectNew = result.filter(x => x.Day == step.new);
              result.forEach(item => {
                if (item.Day == newDay) {
                  item.Day = oldDay
                }
                else if (item.Day == oldDay) {
                  item.Day = newDay
                }
              })
              // æŒ‰ç…§dayçš„å¤§å°æ’åº
              result.sort((a, b) => a.Day - b.Day)
            })

            // æ›´æ–°Sequence
            let Day, DayId, Sequence, Color
            let Id = (document.querySelectorAll('.day-item')[0].dataset.id) * 20;
            let rawStartDateArray = this.rawData.StartDate.split('-')
            console.log(rawStartDateArray);

            let StartDate = new Date(rawStartDateArray[0], rawStartDateArray[1], rawStartDateArray[2])
            let WeekDays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­']
            result.forEach(item => {
              if (item.Type == "Day") {
                Day = item.Day
                DayId = item.DayId
                Sequence = 0
                Color = item.Color
                item.Date = `${StartDate.getMonth()}æœˆ${StartDate.getDate()}æ—¥`
                // ä¿®æ”¹æ—¥æœŸ
                let rawDate = new Date()
                StartDate = new Date(StartDate.setDate(StartDate.getDate() + 1))
                let index = JSON.parse(new Date(StartDate.setDate(StartDate.getDate() + 1)).getDay())
                // console.log((new Date(StartDate.setDate(StartDate.getDate() + 1))).getDay());
                item.WeekDay = WeekDays[index]
              }
              else {
                item.Day = Day
                item.DayId = DayId
                Sequence = Sequence + 1
                item.Sequence = Sequence
                item.Color = Color
              }
              item.Id = Id
              Id = Id + 1
            })
            console.log(result);

            this.rawData.TripContent = result
            this.rawDataOnlyDay = this.rawData.TripContent.filter(x => x.Type == 'Day')
            console.log(this.rawDataOnlyDay);
            console.log(this.markers);

            // return
            // ç§»é™¤markerã€direction
            // if (this.markers.length !== 0) {
            //   this.markers.forEach(marker => {
            //     // marker.setIcon(null)
            //     // marker.setLabel(null);
            //     // marker.setMap(null)
            //     marker.setVisible(false)
            //   })
            //   this.markers = []
            // }
            // if (this.directionsRenderer.length !== 0) {
            //   this.directionsRenderer.forEach(item => {
            //     item.setMap(null)
            //   })
            // }
            // this.calculateRoute(result);

            this.dayItems.forEach(item => {
              item.style.transitionDuration = '10ms'
              item.style.transform = "translateY(0px)"
              item.style = ''
            })
            this.dayContainer.removeChild(this.dayCard)
            this.rawData.TripContent = result
          }
          else {
            // æ²’å‹•
            this.dayContainer.removeChild(this.dayCard)
            this.dayItems.forEach(item => {
              item.style = ''
            })
          }
          this.getData();
        },
        updateDayMove(e) {
          this.checkDayDirection(e)
          console.log(this.selectL);

          // æ¼‚æµ®å¡ç‰‡ç§»å‹•
          this.dayCard.style.transform = `translateX(${this.x}px)`
          if (this.currentDirection == 'right') {
            // å¾€å³ç‚º+
            this.selectD = this.selectD + this.interval_x
            this.stopCardMove = this.checkDayScrollDirection()
            if (!this.stopCardMove) {
              this.selectRight = this.selectRight + this.interval_x
              this.selectLeft = this.selectLeft - this.interval_x
              if (!this.stopMove) {
                if (this.selectRight > this.selectL / 2) {
                  this.changeDayData()
                }
              }
            }
          }
          else if (this.currentDirection == 'left') {
            // å¾€å·¦ç‚º-
            this.selectD = this.selectD - this.interval_x
            this.stopCardMove = this.checkDayScrollDirection()
            if (!this.stopCardMove) {
              this.selectLeft = this.selectLeft + this.interval_x
              this.selectRight = this.selectRight - this.interval_x
              if (!this.stopMove) {
                if (this.selectLeft > this.selectL / 2) {
                  this.changeDayData()
                }
              }
            }
          }
        },
        addDaySteps() {
          if (this.steps.length !== 0) {
            // æª¢æŸ¥æ˜¯å¦ç§»å›åŸä½
            if (this.steps[this.steps.length - 1].old == this.ChangeData.new && this.steps[this.steps.length - 1].new == this.ChangeData.old) {
              // ç§»é™¤æœ€å¾Œä¸€å€‹
              this.steps.pop()
            }
            else {
              this.steps.push(JSON.parse(JSON.stringify(this.ChangeData)))
            }
          }
          else {
            this.steps.push(JSON.parse(JSON.stringify(this.ChangeData)))
          }
          console.log(this.steps);
        },
        changeDayData() {
          let changeNode = this.dayContainer.querySelector(`[data-id="${this.currentId}"]`)
          if (this.currentDirection == 'left') {
            if (changeNode.style.transform == 'translateX(0px)' || changeNode.style.transform == `translateX(${this.selectL}px)`) {
              let moveNode = this.dayContainer.querySelector(`[data-id="${parseInt(this.currentId) - 1}"]`)
              console.log(parseInt(this.currentId) - 1);

              console.log(moveNode);

              moveNode.style.transform = `translateX(${this.selectL}px)`
              this.currentId = parseInt(this.currentId) - 1
            }
            else if (changeNode.style.transform == `translateX(${this.selectL * (-1)}px)`) {
              let moveNode = this.dayContainer.querySelector(`[data-id="${parseInt(this.currentId)}"]`)
              moveNode.style.transform = `translateX(0px)`
              this.currentId = parseInt(this.currentId) - 1
            }
            this.stopScroll = false
            this.selectRight = this.selectL - this.selectLeft
            this.selectLeft = (this.selectL - this.selectLeft) * (-1)
            this.ChangeData.old = parseInt(this.currentId) + 1
            this.ChangeData.new = parseInt(this.currentId)
            this.addDaySteps()
          }
          else if (this.currentDirection == 'right') {
            if (changeNode.style.transform == 'translateX(0px)' || changeNode.style.transform == `translateX(${this.selectL * (-1)}px)`) {
              let moveNode = this.dayContainer.querySelector(`[data-id="${parseInt(this.currentId) + 1}"]`)
              console.log(parseInt(this.currentId) + 1);

              console.log(moveNode);

              moveNode.style.transform = `translateX(${this.selectL * (-1)}px)`
              this.currentId = parseInt(this.currentId) + 1
            }
            else if (changeNode.style.transform == `translateX(${this.selectL * (-1)}px)`) {
              let moveNode = this.dayContainer.querySelector(`[data-id="${parseInt(this.currentId)}"]`)
              moveNode.style.transform = `translateX(0px)`
              this.currentId = parseInt(this.currentId) + 1
            }
            this.stopScroll = false
            this.selectLeft = this.selectL - this.selectRight
            this.selectRight = (this.selectL - this.selectRight) * (-1)
            this.ChangeData.old = parseInt(this.currentId) - 1
            this.ChangeData.new = parseInt(this.currentId)
            this.addDaySteps()
          }
        },

        checkDayDirection(e) {
          // ç›£æ¸¬é¼ æ¨™ä½ç½®
          if (this.clientX !== 0) {
            let changeNode = this.dayContainer.querySelector(`[data-id="${this.currentId}"]`)
            if (this.clientX > e.clientX) {
              this.currentDirection = 'left'
              if (changeNode.style.transform == 'translateX(0px)' ||
                changeNode.style.transform == `translateX(${this.selectL}px)`) {
                this.stopMove = false
              }
              else if (changeNode.style.transform == `translateX(${this.selectL * (-1)}px)`) {
                this.stopMove = false
              }
              this.interval_x = this.clientX - e.clientX
              this.x = this.x - this.interval_x
            }
            else if (this.clientX < e.clientX) {
              this.currentDirection = 'right'
              if (changeNode.style.transform == 'translateX(0px)' ||
                changeNode.style.transform == `translateX(${this.selectL * (-1)}px)`) {
                if (parseInt(this.currentId) + 1 > this.dayItems[this.dayItems.length - 1].dataset.id) {
                  this.stopMove = true
                }
                else {
                  this.stopMove = false
                }
              }
              else if (changeNode.style.transform == `translateX(${this.selectL}px)`) {
                this.stopMove = false
              }
              this.interval_x = e.clientX - this.clientX
              this.x = this.x + this.interval_x
            }
            else {
              this.currentDirection = 'same'
            }
          }
          // è¨˜éŒ„å‰ä¸€æ¬¡æ•¸å€¼ç”¨æ–¼ä¸‹æ¬¡æ¯”è¼ƒ
          this.clientX = e.clientX
        },
        scrollDayMove() {
          // https://developer.mozilla.org/en-US/docs/Web/API/Element/scroll
          // scroll information
          if (this.currentDirection == 'right') {
            if (!this.stopScroll) {
              this.scrollInterval = this.scrollInterval + 1
              this.scrollTarget = this.scrollTarget + this.scrollInterval
              this.dayContainer.scroll(this.scrollTarget, 0)
              if (this.dayContainer.scrollLeft + this.dayContainer.clientWidth >= this.dayContainer.scrollWidth) {
                // ä»£è¡¨åˆ°å³é‚Šåº•
                this.stopScroll = true
                this.scrollTarget = this.dayContainer.scrollLeft
                this.scrollInterval = 0
                // clearTimeInterval
                clearInterval(this.timeId)
                this.timeId = 0
              }
              else {
                this.stopScroll = false
                this.selectRight = this.selectRight + this.scrollInterval
                this.selectLeft = this.selectLeft - this.scrollInterval
                let changeNode = this.dayContainer.querySelector(`[data-id="${this.currentId}"]`)
                if (changeNode.style.transform == 'translateX(0px)' || changeNode.style.transform == `translateX(${this.selectL * (-1)}px)`) {
                  // å¾€å³æ»‘åœæ­¢æ¢ä»¶
                  this.stopMove = parseInt(this.currentId) + 1 > parseInt(this.dayItems[this.dayItems.length - 1].dataset.id) ? true : false
                }
                else if (changeNode.style.transform == `translateX(${this.selectL}px)`) {
                  this.stopMove = false
                }
                if (!this.stopMove) {
                  if (this.selectRight > this.selectL / 2) {
                    this.scrollInterval = 0
                    this.changeDayData()
                  }
                }
              }
            }
          }
          else if (this.currentDirection == 'left') {
            if (!this.stopScroll) {
              this.scrollInterval = this.scrollInterval + 1
              this.scrollTarget = this.scrollTarget - this.scrollInterval
              this.dayContainer.scroll(this.scrollTarget, 0)
              if (this.dayContainer.scrollLeft == 0) {
                // ä»£è¡¨åˆ°å·¦é‚Šåº•
                this.stopScroll = true
                this.scrollTarget = 0
                this.scrollInterval = 0
                // clearTimeInterval
                clearInterval(this.timeId)
                this.timeId = 0
              }
              else {
                this.stopScroll = false
                this.selectRight = this.selectRight - this.scrollInterval
                this.selectLeft = this.selectLeft + this.scrollInterval

                let changeNode = this.dayContainer.querySelector(`[data-id="${this.currentId}"]`)
                if (changeNode.style.transform == 'translateY(0px)' || changeNode.style.transform == `translateY(${this.selectL}px)`) {
                  // å¾€å·¦æ»‘åœæ­¢æ¢ä»¶
                  this.stopMove = parseInt(this.currentId) - 1 < 0 ? true : false
                }
                else if (changeNode.style.transform == `translateY(${this.selectL * (-1)}px)`) {
                  this.stopMove = false
                }
                if (!this.stopMove) {
                  if (this.selectLeft > this.selectL / 2) {
                    this.scrollInterval = 0
                    this.changeDayData()
                  }
                }
              }
            }
          }
        },
        checkDayScrollDirection() {
          let result
          // ç”¨éåŒæ­¥çš„æ–¹å¼è§¸ç™¼
          if (this.selectD > this.totalD) {
            // åˆ°é”æœ€å³å´ï¼Œä¸¦ä¸”scroll baré–‹å§‹æ»‘å‹•
            this.currentDirection = 'right'
            this.stopScroll = false
            result = true
          }
          else if (this.selectD < this.selectL) {
            // åˆ°é”æœ€å·¦å´ï¼Œä¸¦ä¸”scroll baré–‹å§‹æ»‘å‹•
            this.currentDirection = 'left'
            this.stopScroll = false
            result = true
          }
          else {
            // åœæ­¢æ»¾å‹•
            this.stopScroll = true
            result = false
            if (this.stopScroll) {
              if (this.timeId !== 0) {
                clearInterval(this.timeId)
                this.timeId = 0
                console.log(this.timeId);
              }
            }
          }
          if (result) {
            if (this.timeId == 0) {
              this.timeId = setInterval(this.scrollDayMove, 10)
            }
          }
          return result
        },
        InitMap() {
          this.map = new google.maps.Map(this.$refs.map, {
            zoom: 16,
            center: { lat: 25.0336752, lng: 121.5648831 },
            mapTypeControl: false
            // streetViewControl: false
          })

        },
        TripListShow(e) {
          if (e.target.innerWidth >= 768) {
            this.showTripList = true
          }
        },
        calcTripContainerHeight(height) {
          let H = this.$refs.tripListHeaderInfo.scrollHeight
          console.log(this.$refs.tripListHeaderDayContainer.clientHeight);

          this.tripContainer.style.height = `calc(100% - (${this.$refs.tripListHeaderInfo.scrollHeight + height}px)`
          console.log(this.tripContainer.style.height);

        },
      },
      watch: {
        rawData: {
          handler: function (newValue) {
            console.log('watchRawData', newValue);
          },
          deep: true
        },
        edit: {
          handler: function () {
            this.showSpecificRoute = {
              show: false,
              content: {}
            }
            if (this.edit) {
              this.calcTripContainerHeight(99);
            }
            else {
              this.calcTripContainerHeight(49);
            }
            // this.StartDate = new Date(2021, 9, 1)

          }
        },
        StartDate: {
          handler: function (newValue, oldValue) {
            let StartDateAry = newValue.split('-')
            let newDate = new Date(StartDateAry[0], StartDateAry[1], StartDateAry[2])
            let calcDate = new Date(StartDateAry[0], StartDateAry[1], StartDateAry[2])
            if (oldValue !== '') {
              this.rawData.TripContent.filter(x => x.Type == 'Day').forEach((item, index) => {
                if (index == 0) {
                  calcEndDate = new Date(calcDate.setDate(calcDate.getDate()))
                  item.Date = `${calcEndDate.getMonth()}æœˆ${calcEndDate.getDate()}æ—¥`
                }
                else {
                  calcEndDate = new Date(calcDate.setDate(calcDate.getDate() + 1))
                  item.Date = `${calcEndDate.getMonth()}æœˆ${calcEndDate.getDate()}æ—¥`
                }
              })
              this.rawDataOnlyDay = this.rawData.TripContent.filter(x => x.Type == 'Day')
              let EndDate = new Date(newDate.setDate(newDate.getDate() + this.rawData.TotalDate - 1))
              this.StartDateDisplay = `${StartDateAry[0]}å¹´${StartDateAry[1]}æœˆ${StartDateAry[2]}æ—¥`
              this.rawData.StartDate = `${StartDateAry[0]}-${StartDateAry[1]}-${StartDateAry[2]}`
              this.EndDate = `${EndDate.getFullYear()}å¹´${EndDate.getMonth()}æœˆ${EndDate.getDate()}æ—¥`
            }
            console.log(this.rawDataOnlyDay);
            console.log(this.rawData);
          }
        },
      },
      components: {
        day,
        placeGps,
        dayPlus,
        dayCell,
        placeDetail
      },

      mounted() {
        // this.FirstId = 1
        // this.LastId = document.querySelectorAll('.trip-item').length;
        this.tripContainer = this.$refs.tripListDayContainer
        this.searchBox = new google.maps.places.SearchBox(this.$refs.searchBox);
        this.getData();
        this.InitMap();
        window.addEventListener('resize', this.TripListShow)
        this.calcTripContainerHeight()

      },
      beforeDestroy() {
        window.removeEventListener("resize", this.TripListShow);
      }
    }
    Vue.createApp(App).use(ElementPlus).mount('#app');
  </script>
</body>

</html>